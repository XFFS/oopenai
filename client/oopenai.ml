let __NOTE__ = "Generated by oooapi at 2024-1-28T14:33:30Z"
let __TITLE__ = "OpenAI API"
let __API_VERSION__ = "2.0.0"

module Data = struct
  let string_of_file (`File n) = n
  let string_of_str (`String n) = n

  module ChatCompletionMessageToolCall = struct
    type function_ =
      { function__name : string
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@make.required]
      ; function__arguments : string
            [@ocaml.doc
              "The arguments to call the function with, as generated by the \
               model in JSON format. Note that the model does not always \
               generate valid JSON, and may hallucinate parameters not defined \
               by your function schema. Validate the arguments in your code \
               before calling your function."]
            [@yojson.key "arguments"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "The ID of the tool call."]
            [@yojson.key "id"]
            [@make.required]
      ; type_ : string
            [@ocaml.doc
              "The type of the tool. Currently, only `function` is supported."]
            [@yojson.key "type"]
            [@make.required]
      ; function_ : function_
            [@ocaml.doc "The function that the model called."]
            [@yojson.key "function"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestMessageContentPartImage = struct
    type image_url =
      { image_url_url : [ `String of string ]
            [@ocaml.doc
              "Either a URL of the image or the base64 encoded image data."]
            [@yojson.key "url"]
            [@make.required]
      ; image_url_detail : string option
            [@ocaml.doc
              "Specifies the detail level of the image. Learn more in the \
               [Vision \
               guide](/docs/guides/vision/low-or-high-fidelity-image-understanding)."]
            [@yojson.key "detail"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "The type of the content part."]
            [@yojson.key "type"]
            [@make.required]
      ; image_url : image_url [@yojson.key "image_url"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestMessageContentPartText = struct
    type t =
      { type_ : string
            [@ocaml.doc "The type of the content part."]
            [@yojson.key "type"]
            [@make.required]
      ; text : string
            [@ocaml.doc "The text content."]
            [@yojson.key "text"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module FunctionParameters = struct
    type t = Yojson.Safe.t [@@deriving yojson { strict = false }]
  end

  module RunStepDetailsToolCallsCodeOutputImageObject = struct
    type image =
      { image_file_id : string
            [@ocaml.doc
              "The [file](/docs/api-reference/files) ID of the image."]
            [@yojson.key "file_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "Always `image`."] [@yojson.key "type"] [@make.required]
      ; image : image [@yojson.key "image"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepDetailsToolCallsCodeOutputLogsObject = struct
    type t =
      { type_ : string
            [@ocaml.doc "Always `logs`."] [@yojson.key "type"] [@make.required]
      ; logs : string
            [@ocaml.doc "The text output from the Code Interpreter tool call."]
            [@yojson.key "logs"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionMessageToolCalls = struct
    type t = ChatCompletionMessageToolCall.t list
    [@@deriving yojson { strict = false }]
  end

  module ChatCompletionRequestMessageContentPart = struct
    type t = Yojson.Safe.t [@@deriving yojson { strict = false }]
  end

  module FunctionObject = struct
    type t =
      { description : string option
            [@ocaml.doc
              "A description of what the function does, used by the model to \
               choose when and how to call the function."]
            [@yojson.key "description"]
            [@yojson.default None]
      ; name : string
            [@ocaml.doc
              "The name of the function to be called. Must be a-z, A-Z, 0-9, \
               or contain underscores and dashes, with a maximum length of 64."]
            [@yojson.key "name"]
            [@make.required]
      ; parameters : FunctionParameters.t option
            [@yojson.key "parameters"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module MessageContentTextAnnotationsFileCitationObject = struct
    type file_citation =
      { file_citation_file_id : string
            [@ocaml.doc "The ID of the specific File the citation is from."]
            [@yojson.key "file_id"]
            [@make.required]
      ; file_citation_quote : string
            [@ocaml.doc "The specific quote in the file."]
            [@yojson.key "quote"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "Always `file_citation`."]
            [@yojson.key "type"]
            [@make.required]
      ; text : string
            [@ocaml.doc
              "The text in the message content that needs to be replaced."]
            [@yojson.key "text"]
            [@make.required]
      ; file_citation : file_citation
            [@yojson.key "file_citation"] [@make.required]
      ; start_index : int [@yojson.key "start_index"] [@make.required]
      ; end_index : int [@yojson.key "end_index"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module MessageContentTextAnnotationsFilePathObject = struct
    type file_path =
      { file_path_file_id : string
            [@ocaml.doc "The ID of the file that was generated."]
            [@yojson.key "file_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "Always `file_path`."]
            [@yojson.key "type"]
            [@make.required]
      ; text : string
            [@ocaml.doc
              "The text in the message content that needs to be replaced."]
            [@yojson.key "text"]
            [@make.required]
      ; file_path : file_path [@yojson.key "file_path"] [@make.required]
      ; start_index : int [@yojson.key "start_index"] [@make.required]
      ; end_index : int [@yojson.key "end_index"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepDetailsToolCallsCodeObject = struct
    type code_interpreter =
      { code_interpreter_input : string
            [@ocaml.doc "The input to the Code Interpreter tool call."]
            [@yojson.key "input"]
            [@make.required]
      ; code_interpreter_outputs : Yojson.Safe.t list
            [@ocaml.doc
              "The outputs from the Code Interpreter tool call. Code \
               Interpreter can output one or more items, including text \
               (`logs`) or images (`image`). Each of these are represented by \
               a different object type."]
            [@yojson.key "outputs"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "The ID of the tool call."]
            [@yojson.key "id"]
            [@make.required]
      ; type_ : string
            [@ocaml.doc
              "The type of tool call. This is always going to be \
               `code_interpreter` for this type of tool call."]
            [@yojson.key "type"]
            [@make.required]
      ; code_interpreter : code_interpreter
            [@ocaml.doc "The Code Interpreter tool call definition."]
            [@yojson.key "code_interpreter"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepDetailsToolCallsFunctionObject = struct
    type function_ =
      { function__name : string
            [@ocaml.doc "The name of the function."]
            [@yojson.key "name"]
            [@make.required]
      ; function__arguments : string
            [@ocaml.doc "The arguments passed to the function."]
            [@yojson.key "arguments"]
            [@make.required]
      ; function__output : string option
            [@ocaml.doc
              "The output of the function. This will be `null` if the outputs \
               have not been \
               [submitted](/docs/api-reference/runs/submitToolOutputs) yet."]
            [@yojson.key "output"]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "The ID of the tool call object."]
            [@yojson.key "id"]
            [@make.required]
      ; type_ : string
            [@ocaml.doc
              "The type of tool call. This is always going to be `function` \
               for this type of tool call."]
            [@yojson.key "type"]
            [@make.required]
      ; function_ : function_
            [@ocaml.doc "The definition of the function that was called."]
            [@yojson.key "function"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepDetailsToolCallsRetrievalObject = struct
    type retrieval = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "The ID of the tool call object."]
            [@yojson.key "id"]
            [@make.required]
      ; type_ : string
            [@ocaml.doc
              "The type of tool call. This is always going to be `retrieval` \
               for this type of tool call."]
            [@yojson.key "type"]
            [@make.required]
      ; retrieval : retrieval
            [@ocaml.doc "For now, this is always going to be an empty object."]
            [@yojson.key "retrieval"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module AssistantToolsCode = struct
    type t =
      { type_ : string
            [@ocaml.doc "The type of tool being defined: `code_interpreter`"]
            [@yojson.key "type"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module AssistantToolsFunction = struct
    type t =
      { type_ : string
            [@ocaml.doc "The type of tool being defined: `function`"]
            [@yojson.key "type"]
            [@make.required]
      ; function_ : FunctionObject.t [@yojson.key "function"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module AssistantToolsRetrieval = struct
    type t =
      { type_ : string
            [@ocaml.doc "The type of tool being defined: `retrieval`"]
            [@yojson.key "type"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionMessageToolCallChunk = struct
    type function_ =
      { function__name : string option
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@yojson.default None]
      ; function__arguments : string option
            [@ocaml.doc
              "The arguments to call the function with, as generated by the \
               model in JSON format. Note that the model does not always \
               generate valid JSON, and may hallucinate parameters not defined \
               by your function schema. Validate the arguments in your code \
               before calling your function."]
            [@yojson.key "arguments"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { index : int [@yojson.key "index"] [@make.required]
      ; id : string option
            [@ocaml.doc "The ID of the tool call."]
            [@yojson.key "id"]
            [@yojson.default None]
      ; type_ : string option
            [@ocaml.doc
              "The type of the tool. Currently, only `function` is supported."]
            [@yojson.key "type"]
            [@yojson.default None]
      ; function_ : function_ option
            [@yojson.key "function"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionNamedToolChoice = struct
    type function_ =
      { function__name : string
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc
              "The type of the tool. Currently, only `function` is supported."]
            [@yojson.key "type"]
            [@make.required]
      ; function_ : function_ [@yojson.key "function"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestAssistantMessage = struct
    type function_call =
      { function_call_arguments : string
            [@ocaml.doc
              "The arguments to call the function with, as generated by the \
               model in JSON format. Note that the model does not always \
               generate valid JSON, and may hallucinate parameters not defined \
               by your function schema. Validate the arguments in your code \
               before calling your function."]
            [@yojson.key "arguments"]
            [@make.required]
      ; function_call_name : string
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { content : string option option
            [@ocaml.doc
              "The contents of the assistant message. Required unless \
               `tool_calls` or `function_call` is specified.\n"]
            [@yojson.key "content"]
            [@yojson.default None]
      ; role : string
            [@ocaml.doc
              "The role of the messages author, in this case `assistant`."]
            [@yojson.key "role"]
            [@make.required]
      ; name : string option
            [@ocaml.doc
              "An optional name for the participant. Provides the model \
               information to differentiate between participants of the same \
               role."]
            [@yojson.key "name"]
            [@yojson.default None]
      ; tool_calls : ChatCompletionMessageToolCalls.t option
            [@yojson.key "tool_calls"] [@yojson.default None]
      ; function_call : function_call option
            [@ocaml.doc
              "Deprecated and replaced by `tool_calls`. The name and arguments \
               of a function that should be called, as generated by the model."]
            [@yojson.key "function_call"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestFunctionMessage = struct
    type t =
      { role : string
            [@ocaml.doc
              "The role of the messages author, in this case `function`."]
            [@yojson.key "role"]
            [@make.required]
      ; content : string option
            [@ocaml.doc "The contents of the function message."]
            [@yojson.key "content"]
      ; name : string
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestSystemMessage = struct
    type t =
      { content : string
            [@ocaml.doc "The contents of the system message."]
            [@yojson.key "content"]
            [@make.required]
      ; role : string
            [@ocaml.doc
              "The role of the messages author, in this case `system`."]
            [@yojson.key "role"]
            [@make.required]
      ; name : string option
            [@ocaml.doc
              "An optional name for the participant. Provides the model \
               information to differentiate between participants of the same \
               role."]
            [@yojson.key "name"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestToolMessage = struct
    type t =
      { role : string
            [@ocaml.doc "The role of the messages author, in this case `tool`."]
            [@yojson.key "role"]
            [@make.required]
      ; content : string
            [@ocaml.doc "The contents of the tool message."]
            [@yojson.key "content"]
            [@make.required]
      ; tool_call_id : string
            [@ocaml.doc "Tool call that this message is responding to."]
            [@yojson.key "tool_call_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestUserMessage = struct
    type t =
      { content : Yojson.Safe.t
            [@ocaml.doc "The contents of the user message.\n"]
            [@yojson.key "content"]
            [@make.required]
      ; role : string
            [@ocaml.doc "The role of the messages author, in this case `user`."]
            [@yojson.key "role"]
            [@make.required]
      ; name : string option
            [@ocaml.doc
              "An optional name for the participant. Provides the model \
               information to differentiate between participants of the same \
               role."]
            [@yojson.key "name"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateMessageRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { role : string
            [@ocaml.doc
              "The role of the entity that is creating the message. Currently \
               only `user` is supported."]
            [@yojson.key "role"]
            [@make.required]
      ; content : string
            [@ocaml.doc "The content of the message."]
            [@yojson.key "content"]
            [@make.required]
      ; file_ids : string list option
            [@ocaml.doc
              "A list of [File](/docs/api-reference/files) IDs that the \
               message should use. There can be a maximum of 10 files attached \
               to a message. Useful for tools like `retrieval` and \
               `code_interpreter` that can access and use files."]
            [@yojson.key "file_ids"]
            [@yojson.default None]
      ; metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module MessageContentImageFileObject = struct
    type image_file =
      { image_file_file_id : string
            [@ocaml.doc
              "The [File](/docs/api-reference/files) ID of the image in the \
               message content."]
            [@yojson.key "file_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "Always `image_file`."]
            [@yojson.key "type"]
            [@make.required]
      ; image_file : image_file [@yojson.key "image_file"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module MessageContentTextObject = struct
    type text =
      { text_value : string
            [@ocaml.doc "The data that makes up the text."]
            [@yojson.key "value"]
            [@make.required]
      ; text_annotations : Yojson.Safe.t list
            [@yojson.key "annotations"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "Always `text`."] [@yojson.key "type"] [@make.required]
      ; text : text [@yojson.key "text"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunCompletionUsage = struct
    type t =
      { completion_tokens : int
            [@ocaml.doc
              "Number of completion tokens used over the course of the run."]
            [@yojson.key "completion_tokens"]
            [@make.required]
      ; prompt_tokens : int
            [@ocaml.doc
              "Number of prompt tokens used over the course of the run."]
            [@yojson.key "prompt_tokens"]
            [@make.required]
      ; total_tokens : int
            [@ocaml.doc "Total number of tokens used (prompt + completion)."]
            [@yojson.key "total_tokens"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepCompletionUsage = struct
    type t =
      { completion_tokens : int
            [@ocaml.doc
              "Number of completion tokens used over the course of the run \
               step."]
            [@yojson.key "completion_tokens"]
            [@make.required]
      ; prompt_tokens : int
            [@ocaml.doc
              "Number of prompt tokens used over the course of the run step."]
            [@yojson.key "prompt_tokens"]
            [@make.required]
      ; total_tokens : int
            [@ocaml.doc "Total number of tokens used (prompt + completion)."]
            [@yojson.key "total_tokens"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepDetailsMessageCreationObject = struct
    type message_creation =
      { message_creation_message_id : string
            [@ocaml.doc
              "The ID of the message that was created by this run step."]
            [@yojson.key "message_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { type_ : string
            [@ocaml.doc "Always `message_creation`."]
            [@yojson.key "type"]
            [@make.required]
      ; message_creation : message_creation
            [@yojson.key "message_creation"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepDetailsToolCallsObject = struct
    type t =
      { type_ : string
            [@ocaml.doc "Always `tool_calls`."]
            [@yojson.key "type"]
            [@make.required]
      ; tool_calls : Yojson.Safe.t list
            [@ocaml.doc
              "An array of tool calls the run step was involved in. These can \
               be associated with one of three types of tools: \
               `code_interpreter`, `retrieval`, or `function`.\n"]
            [@yojson.key "tool_calls"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunToolCallObject = struct
    type function_ =
      { function__name : string
            [@ocaml.doc "The name of the function."]
            [@yojson.key "name"]
            [@make.required]
      ; function__arguments : string
            [@ocaml.doc
              "The arguments that the model expects you to pass to the \
               function."]
            [@yojson.key "arguments"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The ID of the tool call. This ID must be referenced when you \
               submit the tool outputs in using the [Submit tool outputs to \
               run](/docs/api-reference/runs/submitToolOutputs) endpoint."]
            [@yojson.key "id"]
            [@make.required]
      ; type_ : string
            [@ocaml.doc
              "The type of tool call the output is required for. For now, this \
               is always `function`."]
            [@yojson.key "type"]
            [@make.required]
      ; function_ : function_
            [@ocaml.doc "The function definition."]
            [@yojson.key "function"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module AssistantFileObject = struct
    type t =
      { id : string
            [@ocaml.doc
              "The identifier, which can be referenced in API endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `assistant.file`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the assistant file was \
               created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; assistant_id : string
            [@ocaml.doc "The assistant ID that the file is attached to."]
            [@yojson.key "assistant_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module AssistantObject = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The identifier, which can be referenced in API endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `assistant`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the assistant was \
               created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; name : string option
            [@ocaml.doc
              "The name of the assistant. The maximum length is 256 characters.\n"]
            [@yojson.key "name"]
      ; description : string option
            [@ocaml.doc
              "The description of the assistant. The maximum length is 512 \
               characters.\n"]
            [@yojson.key "description"]
      ; model : string
            [@ocaml.doc
              "ID of the model to use. You can use the [List \
               models](/docs/api-reference/models/list) API to see all of your \
               available models, or see our [Model \
               overview](/docs/models/overview) for descriptions of them.\n"]
            [@yojson.key "model"]
            [@make.required]
      ; instructions : string option
            [@ocaml.doc
              "The system instructions that the assistant uses. The maximum \
               length is 32768 characters.\n"]
            [@yojson.key "instructions"]
      ; tools : Yojson.Safe.t list
            [@ocaml.doc
              "A list of tool enabled on the assistant. There can be a maximum \
               of 128 tools per assistant. Tools can be of types \
               `code_interpreter`, `retrieval`, or `function`.\n"]
            [@yojson.key "tools"]
            [@make.required]
      ; file_ids : string list
            [@ocaml.doc
              "A list of [file](/docs/api-reference/files) IDs attached to \
               this assistant. There can be a maximum of 20 files attached to \
               the assistant. Files are ordered by their creation date in \
               ascending order.\n"]
            [@yojson.key "file_ids"]
            [@make.required]
      ; metadata : metadata option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionFunctionCallOption = struct
    type t =
      { name : string
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionFunctions = struct
    type t =
      { description : string option
            [@ocaml.doc
              "A description of what the function does, used by the model to \
               choose when and how to call the function."]
            [@yojson.key "description"]
            [@yojson.default None]
      ; name : string
            [@ocaml.doc
              "The name of the function to be called. Must be a-z, A-Z, 0-9, \
               or contain underscores and dashes, with a maximum length of 64."]
            [@yojson.key "name"]
            [@make.required]
      ; parameters : FunctionParameters.t option
            [@yojson.key "parameters"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRequestMessage = struct
    type t = Yojson.Safe.t [@@deriving yojson { strict = false }]
  end

  module ChatCompletionResponseMessage = struct
    type function_call =
      { function_call_arguments : string
            [@ocaml.doc
              "The arguments to call the function with, as generated by the \
               model in JSON format. Note that the model does not always \
               generate valid JSON, and may hallucinate parameters not defined \
               by your function schema. Validate the arguments in your code \
               before calling your function."]
            [@yojson.key "arguments"]
            [@make.required]
      ; function_call_name : string
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { content : string option
            [@ocaml.doc "The contents of the message."] [@yojson.key "content"]
      ; tool_calls : ChatCompletionMessageToolCalls.t option
            [@yojson.key "tool_calls"] [@yojson.default None]
      ; role : string
            [@ocaml.doc "The role of the author of this message."]
            [@yojson.key "role"]
            [@make.required]
      ; function_call : function_call option
            [@ocaml.doc
              "Deprecated and replaced by `tool_calls`. The name and arguments \
               of a function that should be called, as generated by the model."]
            [@yojson.key "function_call"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionStreamResponseDelta = struct
    type function_call =
      { function_call_arguments : string option
            [@ocaml.doc
              "The arguments to call the function with, as generated by the \
               model in JSON format. Note that the model does not always \
               generate valid JSON, and may hallucinate parameters not defined \
               by your function schema. Validate the arguments in your code \
               before calling your function."]
            [@yojson.key "arguments"]
            [@yojson.default None]
      ; function_call_name : string option
            [@ocaml.doc "The name of the function to call."]
            [@yojson.key "name"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { content : string option option
            [@ocaml.doc "The contents of the chunk message."]
            [@yojson.key "content"]
            [@yojson.default None]
      ; function_call : function_call option
            [@ocaml.doc
              "Deprecated and replaced by `tool_calls`. The name and arguments \
               of a function that should be called, as generated by the model."]
            [@yojson.key "function_call"]
            [@yojson.default None]
      ; tool_calls : ChatCompletionMessageToolCallChunk.t list option
            [@yojson.key "tool_calls"] [@yojson.default None]
      ; role : string option
            [@ocaml.doc "The role of the author of this message."]
            [@yojson.key "role"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionTokenLogprob = struct
    type top_logprobs_item =
      { top_logprobs_item_token : string
            [@ocaml.doc "The token."] [@yojson.key "token"] [@make.required]
      ; top_logprobs_item_logprob : float
            [@ocaml.doc "The log probability of this token."]
            [@yojson.key "logprob"]
            [@make.required]
      ; top_logprobs_item_bytes : int list option
            [@ocaml.doc
              "A list of integers representing the UTF-8 bytes representation \
               of the token. Useful in instances where characters are \
               represented by multiple tokens and their byte representations \
               must be combined to generate the correct text representation. \
               Can be `null` if there is no bytes representation for the \
               token."]
            [@yojson.key "bytes"]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { token : string
            [@ocaml.doc "The token."] [@yojson.key "token"] [@make.required]
      ; logprob : float
            [@ocaml.doc "The log probability of this token."]
            [@yojson.key "logprob"]
            [@make.required]
      ; bytes : int list option
            [@ocaml.doc
              "A list of integers representing the UTF-8 bytes representation \
               of the token. Useful in instances where characters are \
               represented by multiple tokens and their byte representations \
               must be combined to generate the correct text representation. \
               Can be `null` if there is no bytes representation for the \
               token."]
            [@yojson.key "bytes"]
      ; top_logprobs : top_logprobs_item list
            [@ocaml.doc
              "List of the most likely tokens and their log probability, at \
               this token position. In rare cases, there may be fewer than the \
               number of requested `top_logprobs` returned."]
            [@yojson.key "top_logprobs"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionTool = struct
    type t =
      { type_ : string
            [@ocaml.doc
              "The type of the tool. Currently, only `function` is supported."]
            [@yojson.key "type"]
            [@make.required]
      ; function_ : FunctionObject.t [@yojson.key "function"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionToolChoiceOption = struct
    type t = Yojson.Safe.t [@@deriving yojson { strict = false }]
  end

  module CompletionUsage = struct
    type t =
      { completion_tokens : int
            [@ocaml.doc "Number of tokens in the generated completion."]
            [@yojson.key "completion_tokens"]
            [@make.required]
      ; prompt_tokens : int
            [@ocaml.doc "Number of tokens in the prompt."]
            [@yojson.key "prompt_tokens"]
            [@make.required]
      ; total_tokens : int
            [@ocaml.doc
              "Total number of tokens used in the request (prompt + \
               completion)."]
            [@yojson.key "total_tokens"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateThreadRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { messages : CreateMessageRequest.t list option
            [@ocaml.doc
              "A list of [messages](/docs/api-reference/messages) to start the \
               thread with."]
            [@yojson.key "messages"]
            [@yojson.default None]
      ; metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module Embedding = struct
    type t =
      { index : int
            [@ocaml.doc "The index of the embedding in the list of embeddings."]
            [@yojson.key "index"]
            [@make.required]
      ; embedding : float list
            [@ocaml.doc
              "The embedding vector, which is a list of floats. The length of \
               vector depends on the model as listed in the [embedding \
               guide](/docs/guides/embeddings).\n"]
            [@yojson.key "embedding"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always \"embedding\"."]
            [@yojson.key "object"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module Error = struct
    type t =
      { code : string option [@yojson.key "code"]
      ; message : string [@yojson.key "message"] [@make.required]
      ; param : string option [@yojson.key "param"]
      ; type_ : string [@yojson.key "type"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module FineTuningJob = struct
    type error =
      { error_code : string
            [@ocaml.doc "A machine-readable error code."]
            [@yojson.key "code"]
            [@make.required]
      ; error_message : string
            [@ocaml.doc "A human-readable error message."]
            [@yojson.key "message"]
            [@make.required]
      ; error_param : string option
            [@ocaml.doc
              "The parameter that was invalid, usually `training_file` or \
               `validation_file`. This field will be null if the failure was \
               not parameter-specific."]
            [@yojson.key "param"]
      }
    [@@deriving make, yojson { strict = false }]

    type hyperparameters =
      { hyperparameters_n_epochs : Yojson.Safe.t
            [@ocaml.doc
              "The number of epochs to train the model for. An epoch refers to \
               one full cycle through the training dataset.\n\
               \"auto\" decides the optimal number of epochs based on the size \
               of the dataset. If setting the number manually, we support any \
               number between 1 and 50 epochs."]
            [@yojson.key "n_epochs"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The object identifier, which can be referenced in the API \
               endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the fine-tuning job \
               was created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; error : error option
            [@ocaml.doc
              "For fine-tuning jobs that have `failed`, this will contain more \
               information on the cause of the failure."]
            [@yojson.key "error"]
      ; fine_tuned_model : string option
            [@ocaml.doc
              "The name of the fine-tuned model that is being created. The \
               value will be null if the fine-tuning job is still running."]
            [@yojson.key "fine_tuned_model"]
      ; finished_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the fine-tuning job \
               was finished. The value will be null if the fine-tuning job is \
               still running."]
            [@yojson.key "finished_at"]
      ; hyperparameters : hyperparameters
            [@ocaml.doc
              "The hyperparameters used for the fine-tuning job. See the \
               [fine-tuning guide](/docs/guides/fine-tuning) for more details."]
            [@yojson.key "hyperparameters"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The base model that is being fine-tuned."]
            [@yojson.key "model"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always \"fine_tuning.job\"."]
            [@yojson.key "object"]
            [@make.required]
      ; organization_id : string
            [@ocaml.doc "The organization that owns the fine-tuning job."]
            [@yojson.key "organization_id"]
            [@make.required]
      ; result_files : string list
            [@ocaml.doc
              "The compiled results file ID(s) for the fine-tuning job. You \
               can retrieve the results with the [Files \
               API](/docs/api-reference/files/retrieve-contents)."]
            [@yojson.key "result_files"]
            [@make.required]
      ; status : string
            [@ocaml.doc
              "The current status of the fine-tuning job, which can be either \
               `validating_files`, `queued`, `running`, `succeeded`, `failed`, \
               or `cancelled`."]
            [@yojson.key "status"]
            [@make.required]
      ; trained_tokens : int option
            [@ocaml.doc
              "The total number of billable tokens processed by this \
               fine-tuning job. The value will be null if the fine-tuning job \
               is still running."]
            [@yojson.key "trained_tokens"]
      ; training_file : string
            [@ocaml.doc
              "The file ID used for training. You can retrieve the training \
               data with the [Files \
               API](/docs/api-reference/files/retrieve-contents)."]
            [@yojson.key "training_file"]
            [@make.required]
      ; validation_file : string option
            [@ocaml.doc
              "The file ID used for validation. You can retrieve the \
               validation results with the [Files \
               API](/docs/api-reference/files/retrieve-contents)."]
            [@yojson.key "validation_file"]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module FineTuningJobEvent = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; created_at : int [@yojson.key "created_at"] [@make.required]
      ; level : string [@yojson.key "level"] [@make.required]
      ; message : string [@yojson.key "message"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module Image = struct
    type t =
      { b64_json : string option
            [@ocaml.doc
              "The base64-encoded JSON of the generated image, if \
               `response_format` is `b64_json`."]
            [@yojson.key "b64_json"]
            [@yojson.default None]
      ; url : string option
            [@ocaml.doc
              "The URL of the generated image, if `response_format` is `url` \
               (default)."]
            [@yojson.key "url"]
            [@yojson.default None]
      ; revised_prompt : string option
            [@ocaml.doc
              "The prompt that was used to generate the image, if there was \
               any revision to the prompt."]
            [@yojson.key "revised_prompt"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module MessageFileObject = struct
    type t =
      { id : string
            [@ocaml.doc
              "The identifier, which can be referenced in API endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc
              "The object type, which is always `thread.message.file`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the message file was \
               created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; message_id : string
            [@ocaml.doc
              "The ID of the [message](/docs/api-reference/messages) that the \
               [File](/docs/api-reference/files) is attached to."]
            [@yojson.key "message_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module MessageObject = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The identifier, which can be referenced in API endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `thread.message`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the message was \
               created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; thread_id : string
            [@ocaml.doc
              "The [thread](/docs/api-reference/threads) ID that this message \
               belongs to."]
            [@yojson.key "thread_id"]
            [@make.required]
      ; role : string
            [@ocaml.doc
              "The entity that produced the message. One of `user` or \
               `assistant`."]
            [@yojson.key "role"]
            [@make.required]
      ; content : Yojson.Safe.t list
            [@ocaml.doc
              "The content of the message in array of text and/or images."]
            [@yojson.key "content"]
            [@make.required]
      ; assistant_id : string option
            [@ocaml.doc
              "If applicable, the ID of the \
               [assistant](/docs/api-reference/assistants) that authored this \
               message."]
            [@yojson.key "assistant_id"]
      ; run_id : string option
            [@ocaml.doc
              "If applicable, the ID of the [run](/docs/api-reference/runs) \
               associated with the authoring of this message."]
            [@yojson.key "run_id"]
      ; file_ids : string list
            [@ocaml.doc
              "A list of [file](/docs/api-reference/files) IDs that the \
               assistant should use. Useful for tools like retrieval and \
               code_interpreter that can access files. A maximum of 10 files \
               can be attached to a message."]
            [@yojson.key "file_ids"]
            [@make.required]
      ; metadata : metadata option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module Model = struct
    type t =
      { id : string
            [@ocaml.doc
              "The model identifier, which can be referenced in the API \
               endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; created : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) when the model was created."]
            [@yojson.key "created"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always \"model\"."]
            [@yojson.key "object"]
            [@make.required]
      ; owned_by : string
            [@ocaml.doc "The organization that owns the model."]
            [@yojson.key "owned_by"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module OpenAIFile = struct
    type t =
      { id : string
            [@ocaml.doc
              "The file identifier, which can be referenced in the API \
               endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; bytes : int
            [@ocaml.doc "The size of the file, in bytes."]
            [@yojson.key "bytes"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the file was created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; filename : string
            [@ocaml.doc "The name of the file."]
            [@yojson.key "filename"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `file`."]
            [@yojson.key "object"]
            [@make.required]
      ; purpose : string
            [@ocaml.doc
              "The intended purpose of the file. Supported values are \
               `fine-tune`, `fine-tune-results`, `assistants`, and \
               `assistants_output`."]
            [@yojson.key "purpose"]
            [@make.required]
      ; status : string
            [@ocaml.doc
              "Deprecated. The current status of the file, which can be either \
               `uploaded`, `processed`, or `error`."]
            [@yojson.key "status"]
            [@make.required]
      ; status_details : string option
            [@ocaml.doc
              "Deprecated. For details on why a fine-tuning training file \
               failed validation, see the `error` field on `fine_tuning.job`."]
            [@yojson.key "status_details"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunObject = struct
    type submit_tool_outputs =
      { submit_tool_outputs_tool_calls : RunToolCallObject.t list
            [@ocaml.doc "A list of the relevant tool calls."]
            [@yojson.key "tool_calls"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type required_action =
      { required_action_type_ : string
            [@ocaml.doc "For now, this is always `submit_tool_outputs`."]
            [@yojson.key "type"]
            [@make.required]
      ; required_action_submit_tool_outputs : submit_tool_outputs
            [@ocaml.doc
              "Details on the tool outputs needed for this run to continue."]
            [@yojson.key "submit_tool_outputs"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type last_error =
      { last_error_code : string
            [@ocaml.doc "One of `server_error` or `rate_limit_exceeded`."]
            [@yojson.key "code"]
            [@make.required]
      ; last_error_message : string
            [@ocaml.doc "A human-readable description of the error."]
            [@yojson.key "message"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The identifier, which can be referenced in API endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `thread.run`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run was created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; thread_id : string
            [@ocaml.doc
              "The ID of the [thread](/docs/api-reference/threads) that was \
               executed on as a part of this run."]
            [@yojson.key "thread_id"]
            [@make.required]
      ; assistant_id : string
            [@ocaml.doc
              "The ID of the [assistant](/docs/api-reference/assistants) used \
               for execution of this run."]
            [@yojson.key "assistant_id"]
            [@make.required]
      ; status : string
            [@ocaml.doc
              "The status of the run, which can be either `queued`, \
               `in_progress`, `requires_action`, `cancelling`, `cancelled`, \
               `failed`, `completed`, or `expired`."]
            [@yojson.key "status"]
            [@make.required]
      ; required_action : required_action option
            [@ocaml.doc
              "Details on the action required to continue the run. Will be \
               `null` if no action is required."]
            [@yojson.key "required_action"]
      ; last_error : last_error option
            [@ocaml.doc
              "The last error associated with this run. Will be `null` if \
               there are no errors."]
            [@yojson.key "last_error"]
      ; expires_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run will expire."]
            [@yojson.key "expires_at"]
            [@make.required]
      ; started_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run was started."]
            [@yojson.key "started_at"]
      ; cancelled_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run was cancelled."]
            [@yojson.key "cancelled_at"]
      ; failed_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run failed."]
            [@yojson.key "failed_at"]
      ; completed_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run was completed."]
            [@yojson.key "completed_at"]
      ; model : string
            [@ocaml.doc
              "The model that the [assistant](/docs/api-reference/assistants) \
               used for this run."]
            [@yojson.key "model"]
            [@make.required]
      ; instructions : string
            [@ocaml.doc
              "The instructions that the \
               [assistant](/docs/api-reference/assistants) used for this run."]
            [@yojson.key "instructions"]
            [@make.required]
      ; tools : Yojson.Safe.t list
            [@ocaml.doc
              "The list of tools that the \
               [assistant](/docs/api-reference/assistants) used for this run."]
            [@yojson.key "tools"]
            [@make.required]
      ; file_ids : string list
            [@ocaml.doc
              "The list of [File](/docs/api-reference/files) IDs the \
               [assistant](/docs/api-reference/assistants) used for this run."]
            [@yojson.key "file_ids"]
            [@make.required]
      ; metadata : metadata option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
      ; usage : RunCompletionUsage.t [@yojson.key "usage"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module RunStepObject = struct
    type last_error =
      { last_error_code : string
            [@ocaml.doc "One of `server_error` or `rate_limit_exceeded`."]
            [@yojson.key "code"]
            [@make.required]
      ; last_error_message : string
            [@ocaml.doc "A human-readable description of the error."]
            [@yojson.key "message"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The identifier of the run step, which can be referenced in API \
               endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `thread.run.step`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run step was \
               created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; assistant_id : string
            [@ocaml.doc
              "The ID of the [assistant](/docs/api-reference/assistants) \
               associated with the run step."]
            [@yojson.key "assistant_id"]
            [@make.required]
      ; thread_id : string
            [@ocaml.doc
              "The ID of the [thread](/docs/api-reference/threads) that was \
               run."]
            [@yojson.key "thread_id"]
            [@make.required]
      ; run_id : string
            [@ocaml.doc
              "The ID of the [run](/docs/api-reference/runs) that this run \
               step is a part of."]
            [@yojson.key "run_id"]
            [@make.required]
      ; type_ : string
            [@ocaml.doc
              "The type of run step, which can be either `message_creation` or \
               `tool_calls`."]
            [@yojson.key "type"]
            [@make.required]
      ; status : string
            [@ocaml.doc
              "The status of the run step, which can be either `in_progress`, \
               `cancelled`, `failed`, `completed`, or `expired`."]
            [@yojson.key "status"]
            [@make.required]
      ; step_details : Yojson.Safe.t
            [@ocaml.doc "The details of the run step."]
            [@yojson.key "step_details"]
            [@make.required]
      ; last_error : last_error option
            [@ocaml.doc
              "The last error associated with this run step. Will be `null` if \
               there are no errors."]
            [@yojson.key "last_error"]
      ; expired_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run step expired. \
               A step is considered expired if the parent run is expired."]
            [@yojson.key "expired_at"]
      ; cancelled_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run step was \
               cancelled."]
            [@yojson.key "cancelled_at"]
      ; failed_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run step failed."]
            [@yojson.key "failed_at"]
      ; completed_at : int option
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the run step completed."]
            [@yojson.key "completed_at"]
      ; metadata : metadata option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
      ; usage : RunStepCompletionUsage.t [@yojson.key "usage"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ThreadObject = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "The identifier, which can be referenced in API endpoints."]
            [@yojson.key "id"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `thread`."]
            [@yojson.key "object"]
            [@make.required]
      ; created_at : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) for when the thread was created."]
            [@yojson.key "created_at"]
            [@make.required]
      ; metadata : metadata option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ChatCompletionRole = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module CreateAssistantFileRequest = struct
    type t =
      { file_id : string
            [@ocaml.doc
              "A [File](/docs/api-reference/files) ID (with \
               `purpose=\"assistants\"`) that the assistant should use. Useful \
               for tools like `retrieval` and `code_interpreter` that can \
               access files."]
            [@yojson.key "file_id"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateAssistantRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { model : string
            [@ocaml.doc
              "ID of the model to use. You can use the [List \
               models](/docs/api-reference/models/list) API to see all of your \
               available models, or see our [Model \
               overview](/docs/models/overview) for descriptions of them.\n"]
            [@yojson.key "model"]
            [@make.required]
      ; name : string option option
            [@ocaml.doc
              "The name of the assistant. The maximum length is 256 characters.\n"]
            [@yojson.key "name"]
            [@yojson.default None]
      ; description : string option option
            [@ocaml.doc
              "The description of the assistant. The maximum length is 512 \
               characters.\n"]
            [@yojson.key "description"]
            [@yojson.default None]
      ; instructions : string option option
            [@ocaml.doc
              "The system instructions that the assistant uses. The maximum \
               length is 32768 characters.\n"]
            [@yojson.key "instructions"]
            [@yojson.default None]
      ; tools : Yojson.Safe.t list option
            [@ocaml.doc
              "A list of tool enabled on the assistant. There can be a maximum \
               of 128 tools per assistant. Tools can be of types \
               `code_interpreter`, `retrieval`, or `function`.\n"]
            [@yojson.key "tools"]
            [@yojson.default None]
      ; file_ids : string list option
            [@ocaml.doc
              "A list of [file](/docs/api-reference/files) IDs attached to \
               this assistant. There can be a maximum of 20 files attached to \
               the assistant. Files are ordered by their creation date in \
               ascending order.\n"]
            [@yojson.key "file_ids"]
            [@yojson.default None]
      ; metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateChatCompletionFunctionResponse = struct
    type choices_item =
      { choices_item_finish_reason : string
            [@ocaml.doc
              "The reason the model stopped generating tokens. This will be \
               `stop` if the model hit a natural stop point or a provided stop \
               sequence, `length` if the maximum number of tokens specified in \
               the request was reached, `content_filter` if content was \
               omitted due to a flag from our content filters, or \
               `function_call` if the model called a function.\n"]
            [@yojson.key "finish_reason"]
            [@make.required]
      ; choices_item_index : int
            [@ocaml.doc "The index of the choice in the list of choices."]
            [@yojson.key "index"]
            [@make.required]
      ; choices_item_message : ChatCompletionResponseMessage.t
            [@yojson.key "message"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "A unique identifier for the chat completion."]
            [@yojson.key "id"]
            [@make.required]
      ; choices : choices_item list
            [@ocaml.doc
              "A list of chat completion choices. Can be more than one if `n` \
               is greater than 1."]
            [@yojson.key "choices"]
            [@make.required]
      ; created : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) of when the chat completion was \
               created."]
            [@yojson.key "created"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The model used for the chat completion."]
            [@yojson.key "model"]
            [@make.required]
      ; system_fingerprint : string option
            [@ocaml.doc
              "This fingerprint represents the backend configuration that the \
               model runs with.\n\n\
               Can be used in conjunction with the `seed` request parameter to \
               understand when backend changes have been made that might \
               impact determinism.\n"]
            [@yojson.key "system_fingerprint"]
            [@yojson.default None]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `chat.completion`."]
            [@yojson.key "object"]
            [@make.required]
      ; usage : CompletionUsage.t option
            [@yojson.key "usage"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateChatCompletionImageResponse = struct
    type t = Yojson.Safe.t [@@deriving yojson { strict = false }]
  end

  module CreateChatCompletionRequest = struct
    type logit_bias = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type response_format =
      { response_format_type_ : string option
            [@ocaml.doc "Must be one of `text` or `json_object`."]
            [@yojson.key "type"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { messages : ChatCompletionRequestMessage.t list
            [@ocaml.doc
              "A list of messages comprising the conversation so far. [Example \
               Python \
               code](https://cookbook.openai.com/examples/how_to_format_inputs_to_chatgpt_models)."]
            [@yojson.key "messages"]
            [@make.required]
      ; model : string
            [@ocaml.doc
              "ID of the model to use. See the [model endpoint \
               compatibility](/docs/models/model-endpoint-compatibility) table \
               for details on which models work with the Chat API."]
            [@yojson.key "model"]
            [@make.required]
      ; frequency_penalty : float option
            [@ocaml.doc
              "Number between -2.0 and 2.0. Positive values penalize new \
               tokens based on their existing frequency in the text so far, \
               decreasing the model's likelihood to repeat the same line \
               verbatim.\n\n\
               [See more information about frequency and presence \
               penalties.](/docs/guides/text-generation/parameter-details)\n"]
            [@yojson.key "frequency_penalty"]
            [@yojson.default None]
      ; logit_bias : logit_bias option
            [@ocaml.doc
              "Modify the likelihood of specified tokens appearing in the \
               completion.\n\n\
               Accepts a JSON object that maps tokens (specified by their \
               token ID in the tokenizer) to an associated bias value from \
               -100 to 100. Mathematically, the bias is added to the logits \
               generated by the model prior to sampling. The exact effect will \
               vary per model, but values between -1 and 1 should decrease or \
               increase likelihood of selection; values like -100 or 100 \
               should result in a ban or exclusive selection of the relevant \
               token.\n"]
            [@yojson.key "logit_bias"]
            [@yojson.default None]
      ; logprobs : bool option
            [@ocaml.doc
              "Whether to return log probabilities of the output tokens or \
               not. If true, returns the log probabilities of each output \
               token returned in the `content` of `message`. This option is \
               currently not available on the `gpt-4-vision-preview` model."]
            [@yojson.key "logprobs"]
            [@yojson.default None]
      ; top_logprobs : int option option
            [@ocaml.doc
              "An integer between 0 and 5 specifying the number of most likely \
               tokens to return at each token position, each with an \
               associated log probability. `logprobs` must be set to `true` if \
               this parameter is used."]
            [@yojson.key "top_logprobs"]
            [@yojson.default None]
      ; max_tokens : int option option
            [@ocaml.doc
              "The maximum number of [tokens](/tokenizer) that can be \
               generated in the chat completion.\n\n\
               The total length of input tokens and generated tokens is \
               limited by the model's context length. [Example Python \
               code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) \
               for counting tokens.\n"]
            [@yojson.key "max_tokens"]
            [@yojson.default None]
      ; n : int option
            [@ocaml.doc
              "How many chat completion choices to generate for each input \
               message. Note that you will be charged based on the number of \
               generated tokens across all of the choices. Keep `n` as `1` to \
               minimize costs."]
            [@yojson.key "n"]
            [@yojson.default None]
      ; presence_penalty : float option
            [@ocaml.doc
              "Number between -2.0 and 2.0. Positive values penalize new \
               tokens based on whether they appear in the text so far, \
               increasing the model's likelihood to talk about new topics.\n\n\
               [See more information about frequency and presence \
               penalties.](/docs/guides/text-generation/parameter-details)\n"]
            [@yojson.key "presence_penalty"]
            [@yojson.default None]
      ; response_format : response_format option
            [@ocaml.doc
              "An object specifying the format that the model must output. \
               Compatible with `gpt-4-1106-preview` and `gpt-3.5-turbo-1106`.\n\n\
               Setting to `{ \"type\": \"json_object\" }` enables JSON mode, \
               which guarantees the message the model generates is valid \
               JSON.\n\n\
               **Important:** when using JSON mode, you **must** also instruct \
               the model to produce JSON yourself via a system or user \
               message. Without this, the model may generate an unending \
               stream of whitespace until the generation reaches the token \
               limit, resulting in a long-running and seemingly \"stuck\" \
               request. Also note that the message content may be partially \
               cut off if `finish_reason=\"length\"`, which indicates the \
               generation exceeded `max_tokens` or the conversation exceeded \
               the max context length.\n"]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; seed : int option option
            [@ocaml.doc
              "This feature is in Beta.\n\
               If specified, our system will make a best effort to sample \
               deterministically, such that repeated requests with the same \
               `seed` and parameters should return the same result.\n\
               Determinism is not guaranteed, and you should refer to the \
               `system_fingerprint` response parameter to monitor changes in \
               the backend.\n"]
            [@yojson.key "seed"]
            [@yojson.default None]
      ; stop : Yojson.Safe.t option
            [@ocaml.doc
              "Up to 4 sequences where the API will stop generating further \
               tokens.\n"]
            [@yojson.key "stop"]
            [@yojson.default None]
      ; stream : bool option
            [@ocaml.doc
              "If set, partial message deltas will be sent, like in ChatGPT. \
               Tokens will be sent as data-only [server-sent \
               events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) \
               as they become available, with the stream terminated by a \
               `data: [DONE]` message. [Example Python \
               code](https://cookbook.openai.com/examples/how_to_stream_completions).\n"]
            [@yojson.key "stream"]
            [@yojson.default None]
      ; temperature : float option
            [@ocaml.doc
              "What sampling temperature to use, between 0 and 2. Higher \
               values like 0.8 will make the output more random, while lower \
               values like 0.2 will make it more focused and deterministic.\n\n\
               We generally recommend altering this or `top_p` but not both.\n"]
            [@yojson.key "temperature"]
            [@yojson.default None]
      ; top_p : float option
            [@ocaml.doc
              "An alternative to sampling with temperature, called nucleus \
               sampling, where the model considers the results of the tokens \
               with top_p probability mass. So 0.1 means only the tokens \
               comprising the top 10% probability mass are considered.\n\n\
               We generally recommend altering this or `temperature` but not \
               both.\n"]
            [@yojson.key "top_p"]
            [@yojson.default None]
      ; tools : ChatCompletionTool.t list option
            [@ocaml.doc
              "A list of tools the model may call. Currently, only functions \
               are supported as a tool. Use this to provide a list of \
               functions the model may generate JSON inputs for.\n"]
            [@yojson.key "tools"]
            [@yojson.default None]
      ; tool_choice : ChatCompletionToolChoiceOption.t option
            [@yojson.key "tool_choice"] [@yojson.default None]
      ; user : string option
            [@ocaml.doc
              "A unique identifier representing your end-user, which can help \
               OpenAI to monitor and detect abuse. [Learn \
               more](/docs/guides/safety-best-practices/end-user-ids).\n"]
            [@yojson.key "user"]
            [@yojson.default None]
      ; function_call : Yojson.Safe.t option
            [@ocaml.doc
              "Deprecated in favor of `tool_choice`.\n\n\
               Controls which (if any) function is called by the model.\n\
               `none` means the model will not call a function and instead \
               generates a message.\n\
               `auto` means the model can pick between generating a message or \
               calling a function.\n\
               Specifying a particular function via `{\"name\": \
               \"my_function\"}` forces the model to call that function.\n\n\
               `none` is the default when no functions are present. `auto` is \
               the default if functions are present.\n"]
            [@yojson.key "function_call"]
            [@yojson.default None]
      ; functions : ChatCompletionFunctions.t list option
            [@ocaml.doc
              "Deprecated in favor of `tools`.\n\n\
               A list of functions the model may generate JSON inputs for.\n"]
            [@yojson.key "functions"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateChatCompletionResponse = struct
    type logprobs =
      { logprobs_content : ChatCompletionTokenLogprob.t list option
            [@ocaml.doc
              "A list of message content tokens with log probability \
               information."]
            [@yojson.key "content"]
      }
    [@@deriving make, yojson { strict = false }]

    type choices_item =
      { choices_item_finish_reason : string
            [@ocaml.doc
              "The reason the model stopped generating tokens. This will be \
               `stop` if the model hit a natural stop point or a provided stop \
               sequence,\n\
               `length` if the maximum number of tokens specified in the \
               request was reached,\n\
               `content_filter` if content was omitted due to a flag from our \
               content filters,\n\
               `tool_calls` if the model called a tool, or `function_call` \
               (deprecated) if the model called a function.\n"]
            [@yojson.key "finish_reason"]
            [@make.required]
      ; choices_item_index : int
            [@ocaml.doc "The index of the choice in the list of choices."]
            [@yojson.key "index"]
            [@make.required]
      ; choices_item_message : ChatCompletionResponseMessage.t
            [@yojson.key "message"] [@make.required]
      ; choices_item_logprobs : logprobs option
            [@ocaml.doc "Log probability information for the choice."]
            [@yojson.key "logprobs"]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "A unique identifier for the chat completion."]
            [@yojson.key "id"]
            [@make.required]
      ; choices : choices_item list
            [@ocaml.doc
              "A list of chat completion choices. Can be more than one if `n` \
               is greater than 1."]
            [@yojson.key "choices"]
            [@make.required]
      ; created : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) of when the chat completion was \
               created."]
            [@yojson.key "created"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The model used for the chat completion."]
            [@yojson.key "model"]
            [@make.required]
      ; system_fingerprint : string option
            [@ocaml.doc
              "This fingerprint represents the backend configuration that the \
               model runs with.\n\n\
               Can be used in conjunction with the `seed` request parameter to \
               understand when backend changes have been made that might \
               impact determinism.\n"]
            [@yojson.key "system_fingerprint"]
            [@yojson.default None]
      ; object_ : string
            [@ocaml.doc "The object type, which is always `chat.completion`."]
            [@yojson.key "object"]
            [@make.required]
      ; usage : CompletionUsage.t option
            [@yojson.key "usage"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateChatCompletionStreamResponse = struct
    type logprobs =
      { logprobs_content : ChatCompletionTokenLogprob.t list option
            [@ocaml.doc
              "A list of message content tokens with log probability \
               information."]
            [@yojson.key "content"]
      }
    [@@deriving make, yojson { strict = false }]

    type choices_item =
      { choices_item_delta : ChatCompletionStreamResponseDelta.t
            [@yojson.key "delta"] [@make.required]
      ; choices_item_logprobs : logprobs option option
            [@ocaml.doc "Log probability information for the choice."]
            [@yojson.key "logprobs"]
            [@yojson.default None]
      ; choices_item_finish_reason : string option
            [@ocaml.doc
              "The reason the model stopped generating tokens. This will be \
               `stop` if the model hit a natural stop point or a provided stop \
               sequence,\n\
               `length` if the maximum number of tokens specified in the \
               request was reached,\n\
               `content_filter` if content was omitted due to a flag from our \
               content filters,\n\
               `tool_calls` if the model called a tool, or `function_call` \
               (deprecated) if the model called a function.\n"]
            [@yojson.key "finish_reason"]
      ; choices_item_index : int
            [@ocaml.doc "The index of the choice in the list of choices."]
            [@yojson.key "index"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc
              "A unique identifier for the chat completion. Each chunk has the \
               same ID."]
            [@yojson.key "id"]
            [@make.required]
      ; choices : choices_item list
            [@ocaml.doc
              "A list of chat completion choices. Can be more than one if `n` \
               is greater than 1."]
            [@yojson.key "choices"]
            [@make.required]
      ; created : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) of when the chat completion was \
               created. Each chunk has the same timestamp."]
            [@yojson.key "created"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The model to generate the completion."]
            [@yojson.key "model"]
            [@make.required]
      ; system_fingerprint : string option
            [@ocaml.doc
              "This fingerprint represents the backend configuration that the \
               model runs with.\n\
               Can be used in conjunction with the `seed` request parameter to \
               understand when backend changes have been made that might \
               impact determinism.\n"]
            [@yojson.key "system_fingerprint"]
            [@yojson.default None]
      ; object_ : string
            [@ocaml.doc
              "The object type, which is always `chat.completion.chunk`."]
            [@yojson.key "object"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateCompletionRequest = struct
    type logit_bias = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { model : string
            [@ocaml.doc
              "ID of the model to use. You can use the [List \
               models](/docs/api-reference/models/list) API to see all of your \
               available models, or see our [Model \
               overview](/docs/models/overview) for descriptions of them.\n"]
            [@yojson.key "model"]
            [@make.required]
      ; prompt : Yojson.Safe.t
            [@ocaml.doc
              "The prompt(s) to generate completions for, encoded as a string, \
               array of strings, array of tokens, or array of token arrays.\n\n\
               Note that <|endoftext|> is the document separator that the \
               model sees during training, so if a prompt is not specified the \
               model will generate as if from the beginning of a new document.\n"]
            [@yojson.key "prompt"]
      ; best_of : int option
            [@ocaml.doc
              "Generates `best_of` completions server-side and returns the \
               \"best\" (the one with the highest log probability per token). \
               Results cannot be streamed.\n\n\
               When used with `n`, `best_of` controls the number of candidate \
               completions and `n` specifies how many to return \226\128\147 \
               `best_of` must be greater than `n`.\n\n\
               **Note:** Because this parameter generates many completions, it \
               can quickly consume your token quota. Use carefully and ensure \
               that you have reasonable settings for `max_tokens` and `stop`.\n"]
            [@yojson.key "best_of"]
            [@yojson.default None]
      ; echo : bool option
            [@ocaml.doc "Echo back the prompt in addition to the completion\n"]
            [@yojson.key "echo"]
            [@yojson.default None]
      ; frequency_penalty : float option
            [@ocaml.doc
              "Number between -2.0 and 2.0. Positive values penalize new \
               tokens based on their existing frequency in the text so far, \
               decreasing the model's likelihood to repeat the same line \
               verbatim.\n\n\
               [See more information about frequency and presence \
               penalties.](/docs/guides/text-generation/parameter-details)\n"]
            [@yojson.key "frequency_penalty"]
            [@yojson.default None]
      ; logit_bias : logit_bias option
            [@ocaml.doc
              "Modify the likelihood of specified tokens appearing in the \
               completion.\n\n\
               Accepts a JSON object that maps tokens (specified by their \
               token ID in the GPT tokenizer) to an associated bias value from \
               -100 to 100. You can use this [tokenizer \
               tool](/tokenizer?view=bpe) to convert text to token IDs. \
               Mathematically, the bias is added to the logits generated by \
               the model prior to sampling. The exact effect will vary per \
               model, but values between -1 and 1 should decrease or increase \
               likelihood of selection; values like -100 or 100 should result \
               in a ban or exclusive selection of the relevant token.\n\n\
               As an example, you can pass `{\"50256\": -100}` to prevent the \
               <|endoftext|> token from being generated.\n"]
            [@yojson.key "logit_bias"]
            [@yojson.default None]
      ; logprobs : int option
            [@ocaml.doc
              "Include the log probabilities on the `logprobs` most likely \
               output tokens, as well the chosen tokens. For example, if \
               `logprobs` is 5, the API will return a list of the 5 most \
               likely tokens. The API will always return the `logprob` of the \
               sampled token, so there may be up to `logprobs+1` elements in \
               the response.\n\n\
               The maximum value for `logprobs` is 5.\n"]
            [@yojson.key "logprobs"]
            [@yojson.default None]
      ; max_tokens : int option
            [@ocaml.doc
              "The maximum number of [tokens](/tokenizer) that can be \
               generated in the completion.\n\n\
               The token count of your prompt plus `max_tokens` cannot exceed \
               the model's context length. [Example Python \
               code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) \
               for counting tokens.\n"]
            [@yojson.key "max_tokens"]
            [@yojson.default None]
      ; n : int option
            [@ocaml.doc
              "How many completions to generate for each prompt.\n\n\
               **Note:** Because this parameter generates many completions, it \
               can quickly consume your token quota. Use carefully and ensure \
               that you have reasonable settings for `max_tokens` and `stop`.\n"]
            [@yojson.key "n"]
            [@yojson.default None]
      ; presence_penalty : float option
            [@ocaml.doc
              "Number between -2.0 and 2.0. Positive values penalize new \
               tokens based on whether they appear in the text so far, \
               increasing the model's likelihood to talk about new topics.\n\n\
               [See more information about frequency and presence \
               penalties.](/docs/guides/text-generation/parameter-details)\n"]
            [@yojson.key "presence_penalty"]
            [@yojson.default None]
      ; seed : int option option
            [@ocaml.doc
              "If specified, our system will make a best effort to sample \
               deterministically, such that repeated requests with the same \
               `seed` and parameters should return the same result.\n\n\
               Determinism is not guaranteed, and you should refer to the \
               `system_fingerprint` response parameter to monitor changes in \
               the backend.\n"]
            [@yojson.key "seed"]
            [@yojson.default None]
      ; stop : Yojson.Safe.t option
            [@ocaml.doc
              "Up to 4 sequences where the API will stop generating further \
               tokens. The returned text will not contain the stop sequence.\n"]
            [@yojson.key "stop"]
            [@yojson.default None]
      ; stream : bool option
            [@ocaml.doc
              "Whether to stream back partial progress. If set, tokens will be \
               sent as data-only [server-sent \
               events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) \
               as they become available, with the stream terminated by a \
               `data: [DONE]` message. [Example Python \
               code](https://cookbook.openai.com/examples/how_to_stream_completions).\n"]
            [@yojson.key "stream"]
            [@yojson.default None]
      ; suffix : string option
            [@ocaml.doc
              "The suffix that comes after a completion of inserted text."]
            [@yojson.key "suffix"]
            [@yojson.default None]
      ; temperature : float option
            [@ocaml.doc
              "What sampling temperature to use, between 0 and 2. Higher \
               values like 0.8 will make the output more random, while lower \
               values like 0.2 will make it more focused and deterministic.\n\n\
               We generally recommend altering this or `top_p` but not both.\n"]
            [@yojson.key "temperature"]
            [@yojson.default None]
      ; top_p : float option
            [@ocaml.doc
              "An alternative to sampling with temperature, called nucleus \
               sampling, where the model considers the results of the tokens \
               with top_p probability mass. So 0.1 means only the tokens \
               comprising the top 10% probability mass are considered.\n\n\
               We generally recommend altering this or `temperature` but not \
               both.\n"]
            [@yojson.key "top_p"]
            [@yojson.default None]
      ; user : string option
            [@ocaml.doc
              "A unique identifier representing your end-user, which can help \
               OpenAI to monitor and detect abuse. [Learn \
               more](/docs/guides/safety-best-practices/end-user-ids).\n"]
            [@yojson.key "user"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateCompletionResponse = struct
    type top_logprobs_item = Yojson.Safe.t
    [@@deriving yojson { strict = false }]

    type logprobs =
      { logprobs_text_offset : int list option
            [@yojson.key "text_offset"] [@yojson.default None]
      ; logprobs_token_logprobs : float list option
            [@yojson.key "token_logprobs"] [@yojson.default None]
      ; logprobs_tokens : string list option
            [@yojson.key "tokens"] [@yojson.default None]
      ; logprobs_top_logprobs : top_logprobs_item list option
            [@yojson.key "top_logprobs"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type choices_item =
      { choices_item_finish_reason : string
            [@ocaml.doc
              "The reason the model stopped generating tokens. This will be \
               `stop` if the model hit a natural stop point or a provided stop \
               sequence,\n\
               `length` if the maximum number of tokens specified in the \
               request was reached,\n\
               or `content_filter` if content was omitted due to a flag from \
               our content filters.\n"]
            [@yojson.key "finish_reason"]
            [@make.required]
      ; choices_item_index : int [@yojson.key "index"] [@make.required]
      ; choices_item_logprobs : logprobs option [@yojson.key "logprobs"]
      ; choices_item_text : string [@yojson.key "text"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "A unique identifier for the completion."]
            [@yojson.key "id"]
            [@make.required]
      ; choices : choices_item list
            [@ocaml.doc
              "The list of completion choices the model generated for the \
               input prompt."]
            [@yojson.key "choices"]
            [@make.required]
      ; created : int
            [@ocaml.doc
              "The Unix timestamp (in seconds) of when the completion was \
               created."]
            [@yojson.key "created"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The model used for completion."]
            [@yojson.key "model"]
            [@make.required]
      ; system_fingerprint : string option
            [@ocaml.doc
              "This fingerprint represents the backend configuration that the \
               model runs with.\n\n\
               Can be used in conjunction with the `seed` request parameter to \
               understand when backend changes have been made that might \
               impact determinism.\n"]
            [@yojson.key "system_fingerprint"]
            [@yojson.default None]
      ; object_ : string
            [@ocaml.doc "The object type, which is always \"text_completion\""]
            [@yojson.key "object"]
            [@make.required]
      ; usage : CompletionUsage.t option
            [@yojson.key "usage"] [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateEmbeddingRequest = struct
    type t =
      { input : Yojson.Safe.t
            [@ocaml.doc
              "Input text to embed, encoded as a string or array of tokens. To \
               embed multiple inputs in a single request, pass an array of \
               strings or array of token arrays. The input must not exceed the \
               max input tokens for the model (8192 tokens for \
               `text-embedding-ada-002`), cannot be an empty string, and any \
               array must be 2048 dimensions or less. [Example Python \
               code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) \
               for counting tokens.\n"]
            [@yojson.key "input"]
            [@make.required]
      ; model : string
            [@ocaml.doc
              "ID of the model to use. You can use the [List \
               models](/docs/api-reference/models/list) API to see all of your \
               available models, or see our [Model \
               overview](/docs/models/overview) for descriptions of them.\n"]
            [@yojson.key "model"]
            [@make.required]
      ; encoding_format : string option
            [@ocaml.doc
              "The format to return the embeddings in. Can be either `float` \
               or [`base64`](https://pypi.org/project/pybase64/)."]
            [@yojson.key "encoding_format"]
            [@yojson.default None]
      ; user : string option
            [@ocaml.doc
              "A unique identifier representing your end-user, which can help \
               OpenAI to monitor and detect abuse. [Learn \
               more](/docs/guides/safety-best-practices/end-user-ids).\n"]
            [@yojson.key "user"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateEmbeddingResponse = struct
    type usage =
      { usage_prompt_tokens : int
            [@ocaml.doc "The number of tokens used by the prompt."]
            [@yojson.key "prompt_tokens"]
            [@make.required]
      ; usage_total_tokens : int
            [@ocaml.doc "The total number of tokens used by the request."]
            [@yojson.key "total_tokens"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { data : Embedding.t list
            [@ocaml.doc "The list of embeddings generated by the model."]
            [@yojson.key "data"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The name of the model used to generate the embedding."]
            [@yojson.key "model"]
            [@make.required]
      ; object_ : string
            [@ocaml.doc "The object type, which is always \"list\"."]
            [@yojson.key "object"]
            [@make.required]
      ; usage : usage
            [@ocaml.doc "The usage information for the request."]
            [@yojson.key "usage"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateFileRequest = struct
    type t =
      { file : [ `File of string ]
            [@ocaml.doc "The File object (not file name) to be uploaded.\n"]
            [@yojson.key "file"]
            [@make.required]
      ; purpose : string
            [@ocaml.doc
              "The intended purpose of the uploaded file.\n\n\
               Use \"fine-tune\" for \
               [Fine-tuning](/docs/api-reference/fine-tuning) and \
               \"assistants\" for [Assistants](/docs/api-reference/assistants) \
               and [Messages](/docs/api-reference/messages). This allows us to \
               validate the format of the uploaded file is correct for \
               fine-tuning.\n"]
            [@yojson.key "purpose"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    let to_multipart :
        t -> (string * [> `String of string | `File of string ]) list =
     fun t ->
      List.filter_map
        (fun x -> Fun.id x)
        [ (match Some t.file with
          | None -> None
          | Some v -> Some ("file", `File (string_of_file v)))
        ; (match Some t.purpose with
          | None -> None
          | Some v -> Some ("purpose", `String v))
        ]
  end

  module CreateFineTuningJobRequest = struct
    type hyperparameters =
      { hyperparameters_batch_size : Yojson.Safe.t option
            [@ocaml.doc
              "Number of examples in each batch. A larger batch size means \
               that model parameters\n\
               are updated less frequently, but with lower variance.\n"]
            [@yojson.key "batch_size"]
            [@yojson.default None]
      ; hyperparameters_learning_rate_multiplier : Yojson.Safe.t option
            [@ocaml.doc
              "Scaling factor for the learning rate. A smaller learning rate \
               may be useful to avoid\n\
               overfitting.\n"]
            [@yojson.key "learning_rate_multiplier"]
            [@yojson.default None]
      ; hyperparameters_n_epochs : Yojson.Safe.t option
            [@ocaml.doc
              "The number of epochs to train the model for. An epoch refers to \
               one full cycle\n\
               through the training dataset.\n"]
            [@yojson.key "n_epochs"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { model : string
            [@ocaml.doc
              "The name of the model to fine-tune. You can select one of the\n\
               [supported \
               models](/docs/guides/fine-tuning/what-models-can-be-fine-tuned).\n"]
            [@yojson.key "model"]
            [@make.required]
      ; training_file : string
            [@ocaml.doc
              "The ID of an uploaded file that contains training data.\n\n\
               See [upload file](/docs/api-reference/files/upload) for how to \
               upload a file.\n\n\
               Your dataset must be formatted as a JSONL file. Additionally, \
               you must upload your file with the purpose `fine-tune`.\n\n\
               See the [fine-tuning guide](/docs/guides/fine-tuning) for more \
               details.\n"]
            [@yojson.key "training_file"]
            [@make.required]
      ; hyperparameters : hyperparameters option
            [@ocaml.doc "The hyperparameters used for the fine-tuning job."]
            [@yojson.key "hyperparameters"]
            [@yojson.default None]
      ; suffix : string option
            [@ocaml.doc
              "A string of up to 18 characters that will be added to your \
               fine-tuned model name.\n\n\
               For example, a `suffix` of \"custom-model-name\" would produce \
               a model name like \
               `ft:gpt-3.5-turbo:openai:custom-model-name:7p4lURel`.\n"]
            [@yojson.key "suffix"]
            [@yojson.default None]
      ; validation_file : string option option
            [@ocaml.doc
              "The ID of an uploaded file that contains validation data.\n\n\
               If you provide this file, the data is used to generate validation\n\
               metrics periodically during fine-tuning. These metrics can be \
               viewed in\n\
               the fine-tuning results file.\n\
               The same data should not be present in both train and \
               validation files.\n\n\
               Your dataset must be formatted as a JSONL file. You must upload \
               your file with the purpose `fine-tune`.\n\n\
               See the [fine-tuning guide](/docs/guides/fine-tuning) for more \
               details.\n"]
            [@yojson.key "validation_file"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateImageEditRequest = struct
    type t =
      { image : [ `File of string ]
            [@ocaml.doc
              "The image to edit. Must be a valid PNG file, less than 4MB, and \
               square. If mask is not provided, image must have transparency, \
               which will be used as the mask."]
            [@yojson.key "image"]
            [@make.required]
      ; prompt : string
            [@ocaml.doc
              "A text description of the desired image(s). The maximum length \
               is 1000 characters."]
            [@yojson.key "prompt"]
            [@make.required]
      ; mask : [ `File of string ] option
            [@ocaml.doc
              "An additional image whose fully transparent areas (e.g. where \
               alpha is zero) indicate where `image` should be edited. Must be \
               a valid PNG file, less than 4MB, and have the same dimensions \
               as `image`."]
            [@yojson.key "mask"]
            [@yojson.default None]
      ; model : string option
            [@ocaml.doc
              "The model to use for image generation. Only `dall-e-2` is \
               supported at this time."]
            [@yojson.key "model"]
            [@yojson.default None]
      ; n : int option
            [@ocaml.doc
              "The number of images to generate. Must be between 1 and 10."]
            [@yojson.key "n"]
            [@yojson.default None]
      ; size : string option
            [@ocaml.doc
              "The size of the generated images. Must be one of `256x256`, \
               `512x512`, or `1024x1024`."]
            [@yojson.key "size"]
            [@yojson.default None]
      ; response_format : string option
            [@ocaml.doc
              "The format in which the generated images are returned. Must be \
               one of `url` or `b64_json`."]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; user : string option
            [@ocaml.doc
              "A unique identifier representing your end-user, which can help \
               OpenAI to monitor and detect abuse. [Learn \
               more](/docs/guides/safety-best-practices/end-user-ids).\n"]
            [@yojson.key "user"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    let to_multipart :
        t -> (string * [> `String of string | `File of string ]) list =
     fun t ->
      List.filter_map
        (fun x -> Fun.id x)
        [ (match Some t.image with
          | None -> None
          | Some v -> Some ("image", `File (string_of_file v)))
        ; (match Some t.prompt with
          | None -> None
          | Some v -> Some ("prompt", `String v))
        ; (match t.mask with
          | None -> None
          | Some v -> Some ("mask", `File (string_of_file v)))
        ; (match t.model with
          | None -> None
          | Some v -> Some ("model", `String v))
        ; (match t.n with
          | None -> None
          | Some v -> Some ("n", `String (string_of_int v)))
        ; (match t.size with
          | None -> None
          | Some v -> Some ("size", `String v))
        ; (match t.response_format with
          | None -> None
          | Some v -> Some ("response_format", `String v))
        ; (match t.user with
          | None -> None
          | Some v -> Some ("user", `String v))
        ]
  end

  module CreateImageRequest = struct
    type t =
      { prompt : string
            [@ocaml.doc
              "A text description of the desired image(s). The maximum length \
               is 1000 characters for `dall-e-2` and 4000 characters for \
               `dall-e-3`."]
            [@yojson.key "prompt"]
            [@make.required]
      ; model : string option
            [@ocaml.doc "The model to use for image generation."]
            [@yojson.key "model"]
            [@yojson.default None]
      ; n : int option
            [@ocaml.doc
              "The number of images to generate. Must be between 1 and 10. For \
               `dall-e-3`, only `n=1` is supported."]
            [@yojson.key "n"]
            [@yojson.default None]
      ; quality : string option
            [@ocaml.doc
              "The quality of the image that will be generated. `hd` creates \
               images with finer details and greater consistency across the \
               image. This param is only supported for `dall-e-3`."]
            [@yojson.key "quality"]
            [@yojson.default None]
      ; response_format : string option
            [@ocaml.doc
              "The format in which the generated images are returned. Must be \
               one of `url` or `b64_json`."]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; size : string option
            [@ocaml.doc
              "The size of the generated images. Must be one of `256x256`, \
               `512x512`, or `1024x1024` for `dall-e-2`. Must be one of \
               `1024x1024`, `1792x1024`, or `1024x1792` for `dall-e-3` models."]
            [@yojson.key "size"]
            [@yojson.default None]
      ; style : string option
            [@ocaml.doc
              "The style of the generated images. Must be one of `vivid` or \
               `natural`. Vivid causes the model to lean towards generating \
               hyper-real and dramatic images. Natural causes the model to \
               produce more natural, less hyper-real looking images. This \
               param is only supported for `dall-e-3`."]
            [@yojson.key "style"]
            [@yojson.default None]
      ; user : string option
            [@ocaml.doc
              "A unique identifier representing your end-user, which can help \
               OpenAI to monitor and detect abuse. [Learn \
               more](/docs/guides/safety-best-practices/end-user-ids).\n"]
            [@yojson.key "user"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateImageVariationRequest = struct
    type t =
      { image : [ `File of string ]
            [@ocaml.doc
              "The image to use as the basis for the variation(s). Must be a \
               valid PNG file, less than 4MB, and square."]
            [@yojson.key "image"]
            [@make.required]
      ; model : string option
            [@ocaml.doc
              "The model to use for image generation. Only `dall-e-2` is \
               supported at this time."]
            [@yojson.key "model"]
            [@yojson.default None]
      ; n : int option
            [@ocaml.doc
              "The number of images to generate. Must be between 1 and 10. For \
               `dall-e-3`, only `n=1` is supported."]
            [@yojson.key "n"]
            [@yojson.default None]
      ; response_format : string option
            [@ocaml.doc
              "The format in which the generated images are returned. Must be \
               one of `url` or `b64_json`."]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; size : string option
            [@ocaml.doc
              "The size of the generated images. Must be one of `256x256`, \
               `512x512`, or `1024x1024`."]
            [@yojson.key "size"]
            [@yojson.default None]
      ; user : string option
            [@ocaml.doc
              "A unique identifier representing your end-user, which can help \
               OpenAI to monitor and detect abuse. [Learn \
               more](/docs/guides/safety-best-practices/end-user-ids).\n"]
            [@yojson.key "user"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    let to_multipart :
        t -> (string * [> `String of string | `File of string ]) list =
     fun t ->
      List.filter_map
        (fun x -> Fun.id x)
        [ (match Some t.image with
          | None -> None
          | Some v -> Some ("image", `File (string_of_file v)))
        ; (match t.model with
          | None -> None
          | Some v -> Some ("model", `String v))
        ; (match t.n with
          | None -> None
          | Some v -> Some ("n", `String (string_of_int v)))
        ; (match t.response_format with
          | None -> None
          | Some v -> Some ("response_format", `String v))
        ; (match t.size with
          | None -> None
          | Some v -> Some ("size", `String v))
        ; (match t.user with
          | None -> None
          | Some v -> Some ("user", `String v))
        ]
  end

  module CreateModerationRequest = struct
    type t =
      { input : Yojson.Safe.t
            [@ocaml.doc "The input text to classify"]
            [@yojson.key "input"]
            [@make.required]
      ; model : string option
            [@ocaml.doc
              "Two content moderations models are available: \
               `text-moderation-stable` and `text-moderation-latest`.\n\n\
               The default is `text-moderation-latest` which will be \
               automatically upgraded over time. This ensures you are always \
               using our most accurate model. If you use \
               `text-moderation-stable`, we will provide advanced notice \
               before updating the model. Accuracy of `text-moderation-stable` \
               may be slightly lower than for `text-moderation-latest`.\n"]
            [@yojson.key "model"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateModerationResponse = struct
    type categories =
      { categories_hate : bool
            [@ocaml.doc
              "Content that expresses, incites, or promotes hate based on \
               race, gender, ethnicity, religion, nationality, sexual \
               orientation, disability status, or caste. Hateful content aimed \
               at non-protected groups (e.g., chess players) is harassment."]
            [@yojson.key "hate"]
            [@make.required]
      ; categories_hate_threatening : bool
            [@ocaml.doc
              "Hateful content that also includes violence or serious harm \
               towards the targeted group based on race, gender, ethnicity, \
               religion, nationality, sexual orientation, disability status, \
               or caste."]
            [@yojson.key "hate/threatening"]
            [@make.required]
      ; categories_harassment : bool
            [@ocaml.doc
              "Content that expresses, incites, or promotes harassing language \
               towards any target."]
            [@yojson.key "harassment"]
            [@make.required]
      ; categories_harassment_threatening : bool
            [@ocaml.doc
              "Harassment content that also includes violence or serious harm \
               towards any target."]
            [@yojson.key "harassment/threatening"]
            [@make.required]
      ; categories_self_harm : bool
            [@ocaml.doc
              "Content that promotes, encourages, or depicts acts of \
               self-harm, such as suicide, cutting, and eating disorders."]
            [@yojson.key "self-harm"]
            [@make.required]
      ; categories_self_harm_intent : bool
            [@ocaml.doc
              "Content where the speaker expresses that they are engaging or \
               intend to engage in acts of self-harm, such as suicide, \
               cutting, and eating disorders."]
            [@yojson.key "self-harm/intent"]
            [@make.required]
      ; categories_self_harm_instructions : bool
            [@ocaml.doc
              "Content that encourages performing acts of self-harm, such as \
               suicide, cutting, and eating disorders, or that gives \
               instructions or advice on how to commit such acts."]
            [@yojson.key "self-harm/instructions"]
            [@make.required]
      ; categories_sexual : bool
            [@ocaml.doc
              "Content meant to arouse sexual excitement, such as the \
               description of sexual activity, or that promotes sexual \
               services (excluding sex education and wellness)."]
            [@yojson.key "sexual"]
            [@make.required]
      ; categories_sexual_minors : bool
            [@ocaml.doc
              "Sexual content that includes an individual who is under 18 \
               years old."]
            [@yojson.key "sexual/minors"]
            [@make.required]
      ; categories_violence : bool
            [@ocaml.doc
              "Content that depicts death, violence, or physical injury."]
            [@yojson.key "violence"]
            [@make.required]
      ; categories_violence_graphic : bool
            [@ocaml.doc
              "Content that depicts death, violence, or physical injury in \
               graphic detail."]
            [@yojson.key "violence/graphic"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type category_scores =
      { category_scores_hate : float
            [@ocaml.doc "The score for the category 'hate'."]
            [@yojson.key "hate"]
            [@make.required]
      ; category_scores_hate_threatening : float
            [@ocaml.doc "The score for the category 'hate/threatening'."]
            [@yojson.key "hate/threatening"]
            [@make.required]
      ; category_scores_harassment : float
            [@ocaml.doc "The score for the category 'harassment'."]
            [@yojson.key "harassment"]
            [@make.required]
      ; category_scores_harassment_threatening : float
            [@ocaml.doc "The score for the category 'harassment/threatening'."]
            [@yojson.key "harassment/threatening"]
            [@make.required]
      ; category_scores_self_harm : float
            [@ocaml.doc "The score for the category 'self-harm'."]
            [@yojson.key "self-harm"]
            [@make.required]
      ; category_scores_self_harm_intent : float
            [@ocaml.doc "The score for the category 'self-harm/intent'."]
            [@yojson.key "self-harm/intent"]
            [@make.required]
      ; category_scores_self_harm_instructions : float
            [@ocaml.doc "The score for the category 'self-harm/instructions'."]
            [@yojson.key "self-harm/instructions"]
            [@make.required]
      ; category_scores_sexual : float
            [@ocaml.doc "The score for the category 'sexual'."]
            [@yojson.key "sexual"]
            [@make.required]
      ; category_scores_sexual_minors : float
            [@ocaml.doc "The score for the category 'sexual/minors'."]
            [@yojson.key "sexual/minors"]
            [@make.required]
      ; category_scores_violence : float
            [@ocaml.doc "The score for the category 'violence'."]
            [@yojson.key "violence"]
            [@make.required]
      ; category_scores_violence_graphic : float
            [@ocaml.doc "The score for the category 'violence/graphic'."]
            [@yojson.key "violence/graphic"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type results_item =
      { results_item_flagged : bool
            [@ocaml.doc
              "Whether the content violates [OpenAI's usage \
               policies](/policies/usage-policies)."]
            [@yojson.key "flagged"]
            [@make.required]
      ; results_item_categories : categories
            [@ocaml.doc
              "A list of the categories, and whether they are flagged or not."]
            [@yojson.key "categories"]
            [@make.required]
      ; results_item_category_scores : category_scores
            [@ocaml.doc
              "A list of the categories along with their scores as predicted \
               by model."]
            [@yojson.key "category_scores"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { id : string
            [@ocaml.doc "The unique identifier for the moderation request."]
            [@yojson.key "id"]
            [@make.required]
      ; model : string
            [@ocaml.doc "The model used to generate the moderation results."]
            [@yojson.key "model"]
            [@make.required]
      ; results : results_item list
            [@ocaml.doc "A list of moderation objects."]
            [@yojson.key "results"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateRunRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { assistant_id : string
            [@ocaml.doc
              "The ID of the [assistant](/docs/api-reference/assistants) to \
               use to execute this run."]
            [@yojson.key "assistant_id"]
            [@make.required]
      ; model : string option option
            [@ocaml.doc
              "The ID of the [Model](/docs/api-reference/models) to be used to \
               execute this run. If a value is provided here, it will override \
               the model associated with the assistant. If not, the model \
               associated with the assistant will be used."]
            [@yojson.key "model"]
            [@yojson.default None]
      ; instructions : string option option
            [@ocaml.doc
              "Overrides the \
               [instructions](/docs/api-reference/assistants/createAssistant) \
               of the assistant. This is useful for modifying the behavior on \
               a per-run basis."]
            [@yojson.key "instructions"]
            [@yojson.default None]
      ; additional_instructions : string option option
            [@ocaml.doc
              "Appends additional instructions at the end of the instructions \
               for the run. This is useful for modifying the behavior on a \
               per-run basis without overriding other instructions."]
            [@yojson.key "additional_instructions"]
            [@yojson.default None]
      ; tools : Yojson.Safe.t list option option
            [@ocaml.doc
              "Override the tools the assistant can use for this run. This is \
               useful for modifying the behavior on a per-run basis."]
            [@yojson.key "tools"]
            [@yojson.default None]
      ; metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateSpeechRequest = struct
    type t =
      { model : string
            [@ocaml.doc
              "One of the available [TTS models](/docs/models/tts): `tts-1` or \
               `tts-1-hd`\n"]
            [@yojson.key "model"]
            [@make.required]
      ; input : string
            [@ocaml.doc
              "The text to generate audio for. The maximum length is 4096 \
               characters."]
            [@yojson.key "input"]
            [@make.required]
      ; voice : string
            [@ocaml.doc
              "The voice to use when generating the audio. Supported voices \
               are `alloy`, `echo`, `fable`, `onyx`, `nova`, and `shimmer`. \
               Previews of the voices are available in the [Text to speech \
               guide](/docs/guides/text-to-speech/voice-options)."]
            [@yojson.key "voice"]
            [@make.required]
      ; response_format : string option
            [@ocaml.doc
              "The format to audio in. Supported formats are `mp3`, `opus`, \
               `aac`, and `flac`."]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; speed : float option
            [@ocaml.doc
              "The speed of the generated audio. Select a value from `0.25` to \
               `4.0`. `1.0` is the default."]
            [@yojson.key "speed"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateThreadAndRunRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { assistant_id : string
            [@ocaml.doc
              "The ID of the [assistant](/docs/api-reference/assistants) to \
               use to execute this run."]
            [@yojson.key "assistant_id"]
            [@make.required]
      ; thread : CreateThreadRequest.t option
            [@ocaml.doc
              "If no thread is provided, an empty thread will be created."]
            [@yojson.key "thread"]
            [@yojson.default None]
      ; model : string option option
            [@ocaml.doc
              "The ID of the [Model](/docs/api-reference/models) to be used to \
               execute this run. If a value is provided here, it will override \
               the model associated with the assistant. If not, the model \
               associated with the assistant will be used."]
            [@yojson.key "model"]
            [@yojson.default None]
      ; instructions : string option option
            [@ocaml.doc
              "Override the default system message of the assistant. This is \
               useful for modifying the behavior on a per-run basis."]
            [@yojson.key "instructions"]
            [@yojson.default None]
      ; tools : Yojson.Safe.t list option option
            [@ocaml.doc
              "Override the tools the assistant can use for this run. This is \
               useful for modifying the behavior on a per-run basis."]
            [@yojson.key "tools"]
            [@yojson.default None]
      ; metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateTranscriptionRequest = struct
    type t =
      { file : [ `File of string ]
            [@ocaml.doc
              "The audio file object (not file name) to transcribe, in one of \
               these formats: flac, mp3, mp4, mpeg, mpga, m4a, ogg, wav, or \
               webm.\n"]
            [@yojson.key "file"]
            [@make.required]
      ; model : string
            [@ocaml.doc
              "ID of the model to use. Only `whisper-1` is currently available.\n"]
            [@yojson.key "model"]
            [@make.required]
      ; language : string option
            [@ocaml.doc
              "The language of the input audio. Supplying the input language \
               in \
               [ISO-639-1](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes) \
               format will improve accuracy and latency.\n"]
            [@yojson.key "language"]
            [@yojson.default None]
      ; prompt : string option
            [@ocaml.doc
              "An optional text to guide the model's style or continue a \
               previous audio segment. The \
               [prompt](/docs/guides/speech-to-text/prompting) should match \
               the audio language.\n"]
            [@yojson.key "prompt"]
            [@yojson.default None]
      ; response_format : string option
            [@ocaml.doc
              "The format of the transcript output, in one of these options: \
               `json`, `text`, `srt`, `verbose_json`, or `vtt`.\n"]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; temperature : float option
            [@ocaml.doc
              "The sampling temperature, between 0 and 1. Higher values like \
               0.8 will make the output more random, while lower values like \
               0.2 will make it more focused and deterministic. If set to 0, \
               the model will use [log \
               probability](https://en.wikipedia.org/wiki/Log_probability) to \
               automatically increase the temperature until certain thresholds \
               are hit.\n"]
            [@yojson.key "temperature"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    let to_multipart :
        t -> (string * [> `String of string | `File of string ]) list =
     fun t ->
      List.filter_map
        (fun x -> Fun.id x)
        [ (match Some t.file with
          | None -> None
          | Some v -> Some ("file", `File (string_of_file v)))
        ; (match Some t.model with
          | None -> None
          | Some v -> Some ("model", `String v))
        ; (match t.language with
          | None -> None
          | Some v -> Some ("language", `String v))
        ; (match t.prompt with
          | None -> None
          | Some v -> Some ("prompt", `String v))
        ; (match t.response_format with
          | None -> None
          | Some v -> Some ("response_format", `String v))
        ; (match t.temperature with
          | None -> None
          | Some v -> Some ("temperature", `String (string_of_float v)))
        ]
  end

  module CreateTranscriptionResponse = struct
    type t = { text : string [@yojson.key "text"] [@make.required] }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateTranslationRequest = struct
    type t =
      { file : [ `File of string ]
            [@ocaml.doc
              "The audio file object (not file name) translate, in one of \
               these formats: flac, mp3, mp4, mpeg, mpga, m4a, ogg, wav, or \
               webm.\n"]
            [@yojson.key "file"]
            [@make.required]
      ; model : string
            [@ocaml.doc
              "ID of the model to use. Only `whisper-1` is currently available.\n"]
            [@yojson.key "model"]
            [@make.required]
      ; prompt : string option
            [@ocaml.doc
              "An optional text to guide the model's style or continue a \
               previous audio segment. The \
               [prompt](/docs/guides/speech-to-text/prompting) should be in \
               English.\n"]
            [@yojson.key "prompt"]
            [@yojson.default None]
      ; response_format : string option
            [@ocaml.doc
              "The format of the transcript output, in one of these options: \
               `json`, `text`, `srt`, `verbose_json`, or `vtt`.\n"]
            [@yojson.key "response_format"]
            [@yojson.default None]
      ; temperature : float option
            [@ocaml.doc
              "The sampling temperature, between 0 and 1. Higher values like \
               0.8 will make the output more random, while lower values like \
               0.2 will make it more focused and deterministic. If set to 0, \
               the model will use [log \
               probability](https://en.wikipedia.org/wiki/Log_probability) to \
               automatically increase the temperature until certain thresholds \
               are hit.\n"]
            [@yojson.key "temperature"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    let to_multipart :
        t -> (string * [> `String of string | `File of string ]) list =
     fun t ->
      List.filter_map
        (fun x -> Fun.id x)
        [ (match Some t.file with
          | None -> None
          | Some v -> Some ("file", `File (string_of_file v)))
        ; (match Some t.model with
          | None -> None
          | Some v -> Some ("model", `String v))
        ; (match t.prompt with
          | None -> None
          | Some v -> Some ("prompt", `String v))
        ; (match t.response_format with
          | None -> None
          | Some v -> Some ("response_format", `String v))
        ; (match t.temperature with
          | None -> None
          | Some v -> Some ("temperature", `String (string_of_float v)))
        ]
  end

  module CreateTranslationResponse = struct
    type t = { text : string [@yojson.key "text"] [@make.required] }
    [@@deriving make, yojson { strict = false }]
  end

  module DeleteAssistantFileResponse = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; deleted : bool [@yojson.key "deleted"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module DeleteAssistantResponse = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; deleted : bool [@yojson.key "deleted"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module DeleteFileResponse = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      ; deleted : bool [@yojson.key "deleted"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module DeleteMessageResponse = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; deleted : bool [@yojson.key "deleted"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module DeleteModelResponse = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; deleted : bool [@yojson.key "deleted"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module DeleteThreadResponse = struct
    type t =
      { id : string [@yojson.key "id"] [@make.required]
      ; deleted : bool [@yojson.key "deleted"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ErrorResponse = struct
    type t = { error : Error.t [@yojson.key "error"] [@make.required] }
    [@@deriving make, yojson { strict = false }]
  end

  module ImagesResponse = struct
    type t =
      { created : int [@yojson.key "created"] [@make.required]
      ; data : Image.t list [@yojson.key "data"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListAssistantFilesResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : AssistantFileObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListAssistantsResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : AssistantObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListFilesResponse = struct
    type t =
      { data : OpenAIFile.t list [@yojson.key "data"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListFineTuningJobEventsResponse = struct
    type t =
      { data : FineTuningJobEvent.t list [@yojson.key "data"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListMessageFilesResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : MessageFileObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListMessagesResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : MessageObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListModelsResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : Model.t list [@yojson.key "data"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListPaginatedFineTuningJobsResponse = struct
    type t =
      { data : FineTuningJob.t list [@yojson.key "data"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      ; object_ : string [@yojson.key "object"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListRunStepsResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : RunStepObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListRunsResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : RunObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ListThreadsResponse = struct
    type t =
      { object_ : string [@yojson.key "object"] [@make.required]
      ; data : ThreadObject.t list [@yojson.key "data"] [@make.required]
      ; first_id : string [@yojson.key "first_id"] [@make.required]
      ; last_id : string [@yojson.key "last_id"] [@make.required]
      ; has_more : bool [@yojson.key "has_more"] [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ModifyAssistantRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { model : string option
            [@ocaml.doc
              "ID of the model to use. You can use the [List \
               models](/docs/api-reference/models/list) API to see all of your \
               available models, or see our [Model \
               overview](/docs/models/overview) for descriptions of them.\n"]
            [@yojson.key "model"]
            [@yojson.default None]
      ; name : string option option
            [@ocaml.doc
              "The name of the assistant. The maximum length is 256 characters.\n"]
            [@yojson.key "name"]
            [@yojson.default None]
      ; description : string option option
            [@ocaml.doc
              "The description of the assistant. The maximum length is 512 \
               characters.\n"]
            [@yojson.key "description"]
            [@yojson.default None]
      ; instructions : string option option
            [@ocaml.doc
              "The system instructions that the assistant uses. The maximum \
               length is 32768 characters.\n"]
            [@yojson.key "instructions"]
            [@yojson.default None]
      ; tools : Yojson.Safe.t list option
            [@ocaml.doc
              "A list of tool enabled on the assistant. There can be a maximum \
               of 128 tools per assistant. Tools can be of types \
               `code_interpreter`, `retrieval`, or `function`.\n"]
            [@yojson.key "tools"]
            [@yojson.default None]
      ; file_ids : string list option
            [@ocaml.doc
              "A list of [File](/docs/api-reference/files) IDs attached to \
               this assistant. There can be a maximum of 20 files attached to \
               the assistant. Files are ordered by their creation date in \
               ascending order. If a file was previously attached to the list \
               but does not show up in the list, it will be deleted from the \
               assistant.\n"]
            [@yojson.key "file_ids"]
            [@yojson.default None]
      ; metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ModifyMessageRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ModifyRunRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module ModifyThreadRequest = struct
    type metadata = Yojson.Safe.t [@@deriving yojson { strict = false }]

    type t =
      { metadata : metadata option option
            [@ocaml.doc
              "Set of 16 key-value pairs that can be attached to an object. \
               This can be useful for storing additional information about the \
               object in a structured format. Keys can be a maximum of 64 \
               characters long and values can be a maxium of 512 characters \
               long.\n"]
            [@yojson.key "metadata"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module SubmitToolOutputsRunRequest = struct
    type tool_outputs_item =
      { tool_outputs_item_tool_call_id : string option
            [@ocaml.doc
              "The ID of the tool call in the `required_action` object within \
               the run object the output is being submitted for."]
            [@yojson.key "tool_call_id"]
            [@yojson.default None]
      ; tool_outputs_item_output : string option
            [@ocaml.doc
              "The output of the tool call to be submitted to continue the run."]
            [@yojson.key "output"]
            [@yojson.default None]
      }
    [@@deriving make, yojson { strict = false }]

    type t =
      { tool_outputs : tool_outputs_item list
            [@ocaml.doc
              "A list of tools for which the outputs are being submitted."]
            [@yojson.key "tool_outputs"]
            [@make.required]
      }
    [@@deriving make, yojson { strict = false }]
  end

  module CreateSpeechResponse = struct
    type t = [ `File of string ] [@@deriving yojson { strict = false }]
  end

  module DownloadFileResponse = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamAssistantId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamFileId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamFineTuningJobId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamMessageId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamModel = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamRunId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamStepId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module PathParamThreadId = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module QueryParamAfter = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module QueryParamBefore = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module QueryParamLimit = struct
    type t = int [@@deriving yojson { strict = false }]
  end

  module QueryParamOrder = struct
    type t = string [@@deriving yojson { strict = false }]
  end

  module QueryParamPurpose = struct
    type t = string [@@deriving yojson { strict = false }]
  end
end

let base_url = "https://api.openai.com/v1"

module Make (Client : Oooapi_lib.Client) (Config : Oooapi_lib.Config) = struct
  open Oooapi_lib.Cohttp_client (Config)

  let get_message_file ~file_id ~message_id ~thread_id () =
    let path =
      [ "threads"; thread_id; "messages"; message_id; "files"; file_id ]
    in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.MessageFileObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let list_message_files
      ?after
      ?before
      ?(limit = 20)
      ?(order = "desc")
      ~message_id
      ~thread_id
      () =
    let path = [ "threads"; thread_id; "messages"; message_id; "files" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Option.map (fun p -> "before", (fun x -> x) p) before
        ; Some ("limit", string_of_int limit)
        ; Some ("order", (fun x -> x) order)
        ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListMessageFilesResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let get_assistant_file ~assistant_id ~file_id () =
    let path = [ "assistants"; assistant_id; "files"; file_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.AssistantFileObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let delete_assistant_file ~assistant_id ~file_id () =
    let path = [ "assistants"; assistant_id; "files"; file_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.DeleteAssistantFileResponse.of_yojson in
    let data = None in
    make_request `DELETE ~base_url ~path ~params ~headers ~decode ?data

  let list_assistant_files
      ?after
      ?before
      ?(limit = 20)
      ?(order = "desc")
      ~assistant_id
      () =
    let path = [ "assistants"; assistant_id; "files" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Option.map (fun p -> "before", (fun x -> x) p) before
        ; Some ("limit", string_of_int limit)
        ; Some ("order", (fun x -> x) order)
        ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListAssistantFilesResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let create_assistant_file ~assistant_id data =
    let path = [ "assistants"; assistant_id; "files" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.AssistantFileObject.of_yojson in
    let data = Some (`Json (Data.CreateAssistantFileRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let get_run_step ~run_id ~step_id ~thread_id () =
    let path = [ "threads"; thread_id; "runs"; run_id; "steps"; step_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunStepObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let list_run_steps
      ?after
      ?before
      ?(limit = 20)
      ?(order = "desc")
      ~run_id
      ~thread_id
      () =
    let path = [ "threads"; thread_id; "runs"; run_id; "steps" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Option.map (fun p -> "before", (fun x -> x) p) before
        ; Some ("limit", string_of_int limit)
        ; Some ("order", (fun x -> x) order)
        ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListRunStepsResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let cancel_run ~run_id ~thread_id () =
    let path = [ "threads"; thread_id; "runs"; run_id; "cancel" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunObject.of_yojson in
    let data = None in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let submit_tool_ouputs_to_run ~run_id ~thread_id data =
    let path =
      [ "threads"; thread_id; "runs"; run_id; "submit_tool_outputs" ]
    in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunObject.of_yojson in
    let data = Some (`Json (Data.SubmitToolOutputsRunRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let get_run ~run_id ~thread_id () =
    let path = [ "threads"; thread_id; "runs"; run_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let modify_run ~run_id ~thread_id data =
    let path = [ "threads"; thread_id; "runs"; run_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunObject.of_yojson in
    let data = Some (`Json (Data.ModifyRunRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let list_runs ?after ?before ?(limit = 20) ?(order = "desc") ~thread_id () =
    let path = [ "threads"; thread_id; "runs" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Option.map (fun p -> "before", (fun x -> x) p) before
        ; Some ("limit", string_of_int limit)
        ; Some ("order", (fun x -> x) order)
        ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListRunsResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let create_run ~thread_id data =
    let path = [ "threads"; thread_id; "runs" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunObject.of_yojson in
    let data = Some (`Json (Data.CreateRunRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_thread_and_run data =
    let path = [ "threads"; "runs" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.RunObject.of_yojson in
    let data = Some (`Json (Data.CreateThreadAndRunRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let get_message ~message_id ~thread_id () =
    let path = [ "threads"; thread_id; "messages"; message_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.MessageObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let modify_message ~message_id ~thread_id data =
    let path = [ "threads"; thread_id; "messages"; message_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.MessageObject.of_yojson in
    let data = Some (`Json (Data.ModifyMessageRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let list_messages ?after ?before ?(limit = 20) ?(order = "desc") ~thread_id ()
      =
    let path = [ "threads"; thread_id; "messages" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Option.map (fun p -> "before", (fun x -> x) p) before
        ; Some ("limit", string_of_int limit)
        ; Some ("order", (fun x -> x) order)
        ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListMessagesResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let create_message ~thread_id data =
    let path = [ "threads"; thread_id; "messages" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.MessageObject.of_yojson in
    let data = Some (`Json (Data.CreateMessageRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let get_thread ~thread_id () =
    let path = [ "threads"; thread_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ThreadObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let modify_thread ~thread_id data =
    let path = [ "threads"; thread_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ThreadObject.of_yojson in
    let data = Some (`Json (Data.ModifyThreadRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let delete_thread ~thread_id () =
    let path = [ "threads"; thread_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.DeleteThreadResponse.of_yojson in
    let data = None in
    make_request `DELETE ~base_url ~path ~params ~headers ~decode ?data

  let create_thread data =
    let path = [ "threads" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ThreadObject.of_yojson in
    let data = Some (`Json (Data.CreateThreadRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let get_assistant ~assistant_id () =
    let path = [ "assistants"; assistant_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.AssistantObject.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let modify_assistant ~assistant_id data =
    let path = [ "assistants"; assistant_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.AssistantObject.of_yojson in
    let data = Some (`Json (Data.ModifyAssistantRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let delete_assistant ~assistant_id () =
    let path = [ "assistants"; assistant_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.DeleteAssistantResponse.of_yojson in
    let data = None in
    make_request `DELETE ~base_url ~path ~params ~headers ~decode ?data

  let list_assistants ?after ?before ?(limit = 20) ?(order = "desc") () =
    let path = [ "assistants" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Option.map (fun p -> "before", (fun x -> x) p) before
        ; Some ("limit", string_of_int limit)
        ; Some ("order", (fun x -> x) order)
        ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListAssistantsResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let create_assistant data =
    let path = [ "assistants" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.AssistantObject.of_yojson in
    let data = Some (`Json (Data.CreateAssistantRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_moderation data =
    let path = [ "moderations" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.CreateModerationResponse.of_yojson in
    let data = Some (`Json (Data.CreateModerationRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let retrieve_model ~model () =
    let path = [ "models"; model ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.Model.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let delete_model ~model () =
    let path = [ "models"; model ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.DeleteModelResponse.of_yojson in
    let data = None in
    make_request `DELETE ~base_url ~path ~params ~headers ~decode ?data

  let list_models () =
    let path = [ "models" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ListModelsResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let cancel_fine_tuning_job ~fine_tuning_job_id () =
    let path = [ "fine_tuning"; "jobs"; fine_tuning_job_id; "cancel" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.FineTuningJob.of_yojson in
    let data = None in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let list_fine_tuning_events ?after ?(limit = 20) ~fine_tuning_job_id () =
    let path = [ "fine_tuning"; "jobs"; fine_tuning_job_id; "events" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Some ("limit", string_of_int limit)
        ]
    in
    let headers = [] in
    let decode =
      of_json_string Data.ListFineTuningJobEventsResponse.of_yojson
    in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let retrieve_fine_tuning_job ~fine_tuning_job_id () =
    let path = [ "fine_tuning"; "jobs"; fine_tuning_job_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.FineTuningJob.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let list_paginated_fine_tuning_jobs ?after ?(limit = 20) () =
    let path = [ "fine_tuning"; "jobs" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "after", (fun x -> x) p) after
        ; Some ("limit", string_of_int limit)
        ]
    in
    let headers = [] in
    let decode =
      of_json_string Data.ListPaginatedFineTuningJobsResponse.of_yojson
    in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let create_fine_tuning_job data =
    let path = [ "fine_tuning"; "jobs" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.FineTuningJob.of_yojson in
    let data = Some (`Json (Data.CreateFineTuningJobRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let download_file ~file_id () =
    let path = [ "files"; file_id; "content" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.DownloadFileResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let retrieve_file ~file_id () =
    let path = [ "files"; file_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.OpenAIFile.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let delete_file ~file_id () =
    let path = [ "files"; file_id ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.DeleteFileResponse.of_yojson in
    let data = None in
    make_request `DELETE ~base_url ~path ~params ~headers ~decode ?data

  let list_files ?purpose () =
    let path = [ "files" ] in
    let params =
      List.filter_map
        Fun.id
        [ Option.map (fun p -> "purpose", (fun x -> x) p) purpose ]
    in
    let headers = [] in
    let decode = of_json_string Data.ListFilesResponse.of_yojson in
    let data = None in
    make_request `GET ~base_url ~path ~params ~headers ~decode ?data

  let create_file data =
    let path = [ "files" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.OpenAIFile.of_yojson in
    let data =
      Some (`Multipart_form (Data.CreateFileRequest.to_multipart data))
    in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_translation data =
    let path = [ "audio"; "translations" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.CreateTranslationResponse.of_yojson in
    let data =
      Some (`Multipart_form (Data.CreateTranslationRequest.to_multipart data))
    in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_transcription data =
    let path = [ "audio"; "transcriptions" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.CreateTranscriptionResponse.of_yojson in
    let data =
      Some (`Multipart_form (Data.CreateTranscriptionRequest.to_multipart data))
    in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_speech data =
    let path = [ "audio"; "speech" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode x = Ok x in
    let data = Some (`Json (Data.CreateSpeechRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_embedding data =
    let path = [ "embeddings" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.CreateEmbeddingResponse.of_yojson in
    let data = Some (`Json (Data.CreateEmbeddingRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_image_variation data =
    let path = [ "images"; "variations" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ImagesResponse.of_yojson in
    let data =
      Some
        (`Multipart_form (Data.CreateImageVariationRequest.to_multipart data))
    in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_image_edit data =
    let path = [ "images"; "edits" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ImagesResponse.of_yojson in
    let data =
      Some (`Multipart_form (Data.CreateImageEditRequest.to_multipart data))
    in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_image data =
    let path = [ "images"; "generations" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.ImagesResponse.of_yojson in
    let data = Some (`Json (Data.CreateImageRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_completion data =
    let path = [ "completions" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.CreateCompletionResponse.of_yojson in
    let data = Some (`Json (Data.CreateCompletionRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data

  let create_chat_completion data =
    let path = [ "chat"; "completions" ] in
    let params = List.filter_map Fun.id [] in
    let headers = [] in
    let decode = of_json_string Data.CreateChatCompletionResponse.of_yojson in
    let data = Some (`Json (Data.CreateChatCompletionRequest.to_yojson data)) in
    make_request `POST ~base_url ~path ~params ~headers ~decode ?data
end
